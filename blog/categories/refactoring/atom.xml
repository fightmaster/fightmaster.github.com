<?xml version="1.0" encoding="utf-8"?>
<feed xmlns="http://www.w3.org/2005/Atom">

  <title><![CDATA[Category: refactoring | fightmaster's blog]]></title>
  <link href="http://fightmaster.github.io/blog/categories/refactoring/atom.xml" rel="self"/>
  <link href="http://fightmaster.github.io/"/>
  <updated>2014-01-19T13:11:20+04:00</updated>
  <id>http://fightmaster.github.io/</id>
  <author>
    <name><![CDATA[fightmaster]]></name>
    
  </author>
  <generator uri="http://octopress.org/">Octopress</generator>

  
  <entry>
    <title type="html"><![CDATA[Все дело в том, что так бывает...]]></title>
    <link href="http://fightmaster.github.io/blog/2013/10/17/the-whole-point-is-that-it-happens.html"/>
    <updated>2013-10-17T23:00:00+04:00</updated>
    <id>http://fightmaster.github.io/blog/2013/10/17/the-whole-point-is-that-it-happens</id>
    <content type="html"><![CDATA[<p>Именно так начинается одно из моих любимых стихотворений. Я собирался сегодня прийти домой и пописать код, но внезапно мне пришла в голову мораль одной басни, сюжет которой случился днем. Рекомендую уделить немного времени, хотя бы потому что это случалось с вами.</p>

<!-- more -->


<p>В статье про <a href="http://fightmaster.github.io/blog/2013/09/25/code-review.html">код ревью</a> был &ldquo;запрос&rdquo; на практическую сторону. Но руки не доходят написать что-то, да и сделать это достаточно сложно, по крайней мере в том виде, в котором я вижу. Скорее всего, она появится из таких маленьких статей, как эта.</p>

<h3>Кусочек сыра</h3>

<p>Сегодня попался на глаза вот такой кусочек кода.</p>

<p>```php
&lt;?php
//code
if (!Utilities::arrayContains($array1, $array2)) {</p>

<pre><code>return false;
</code></pre>

<p>}
//code
?>
```</p>

<p>Думаю что-то не так. Создают функцию в классе <code>Utilities</code> только тогда, когда не могут определить ее принадлежность. Что уже странно. Во-вторых, ну название. Вроде бы и понятно все, с другой стороны, не внушает какого-то доверия.</p>

<p>```php
&lt;?php
/<em>*
 * @param array $array1
 * @param array $array2
 * @return boolean
 </em>/
public static function arrayContains(array $array1, array $array2)
{</p>

<pre><code>foreach ($array1 as $value1) {
    if (!in_array($value1, $array2)) {
        return false;
    }
}

return true;
</code></pre>

<p>}
?>
```</p>

<p>Действительно, несколько раз пробегаю глазами, так как боюсь упустить что-то, заставляя себя поверить в увиденное. Аккуратно оставляю предложение заменить содержание на <code>&lt;?php empty(array_diff($array1, $array2));?&gt;</code>, переименовать или удалить метод.</p>

<p>В итоге вечером получаем&hellip;</p>

<p>```php
&lt;?php
/<em>*
 * @param array $array1
 * @param array $array2
 * @return boolean
 </em>/
public static function isArrayDiff(array $array1, array $array2)
{</p>

<pre><code>$diff = array_diff($array1, $array2);

return empty($diff);
</code></pre>

<p>}
?>
```</p>

<h3>Про лису</h3>

<p>Хитрый лис не скажет вороне: &ldquo;Дай сыр, птица&rdquo;. Во-первых, она может не дать его. Во-вторых, навряд ли это чему-то научит, басня-то не получится и морали не будет. Поэтому идеальный вариант для ревью &ndash; это подача чего угодно в наилучшем виде для автора кода. В более сложных случаях я и свой вариант содержания не предлагаю, так как его у меня просто нет. Просто прошу еще раз подумать, в сложных ситуациях спасает парное программирование. При этом не надо выступать в роли оратора или диктатора. Если вы хотите думать за всех, пишите проект один тогда. Не могу сказать, что у меня всегда получается быть хитропопой лисой, но я стараюсь.</p>

<h3>Про чистый код и ворону</h3>

<p>Я думаю, что знаю на 99 процентов причину появления такого метода. Конечно, человек уже наелся определенного куска проекта. Метод вызывается в очень неприятном месте с кучей условных конструкций, хотелось как-то лучше разгрести. Скорее всего, в голову не пришла функция <code>array_diff</code>, и вынос <code>foreach</code> в отдельный метод &ndash; правильный выбор.</p>

<p>Но сам урок начался позже. Методы из двух строчек имеют место быть, все дело в названии. В последнем варианте мы получили обертку над стандартной функцией. В данном контексте она бессмысленна. Если мы захотим реализовать работу со стеком в ООП стиле и обернуть <code>array_pop</code> и <code>array_push</code> в класс и методы, то у нас будет цель и причина всего этого. Здесь цель не прослеживается.</p>

<p>Так что же делать в данном случае? Я бы подумал над куском кода, где это вызывается. Возможно, существует определение этой операции в целом. Ведь массивы что-то содержат, у них есть нормальные имена (в статье они преднамеренно переведены в <code>array1</code> и <code>array2</code>).</p>

<p>Например, если бы <code>array1</code> содержал права пользователя, а <code>array2</code> все необходимые права на просмотр страницы. Тогда, на мой скромный взгляд, метод имеет место быть на 101 процент, с каким-нибудь именем <code>isAllow*</code>.</p>

<p>Если мы не можем как-то определить и выделить по смыслу эти строчки, то и выносить их, скорее всего, нет смысла.</p>

<h3>Мораль басни</h3>

<p>Я думаю, стервятники и любители поржать даже не зайдут в этот скромный блог. В чем же я увидел &ldquo;мораль&rdquo; и почему такое название статьи?</p>

<p>Вы что-то прочитали, у вас куча идей и желание все перехерачить. А что-то идеальное лежит почему-то всегда на &ldquo;горном перевале&rdquo;. Так бывает, что на эмоциях мы проскакиваем его. Прочитали о паттернах &ndash; давай плодить из plain php кучу классов, выстраивать архитектуру, которая в итоге ничуть не понятнее. Прочитали дядюшку Боба &ndash; давай все дробить без остановки. Прочитали про agile &ndash; давай ломать работу проекта. Прочитали статью &ndash; давай сразу внедрять.</p>

<p>Я сам постоянно допускаю подобные ошибки, но при этом думаю, что это правильно. Продолжая горную тему: это лучше, чем сидеть перед перевалом всю жизнь, не совершая каких-то дерзких попыток покорения вершин, или вообще спуститься в долину со словами: &ldquo;Да ну нафиг эти горы&rdquo;. С приобретением опыта наши просчеты уменьшаются, а какими путниками мы станем, зависит только от нас.</p>

<p>Статью завершу словами: &ldquo;Лучше гор могут быть только горы, на которых никто не бывал&rdquo;.</p>
]]></content>
  </entry>
  
</feed>
