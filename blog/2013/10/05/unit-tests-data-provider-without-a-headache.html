
<!DOCTYPE html>
<!--[if IEMobile 7 ]><html class="no-js iem7"><![endif]-->
<!--[if lt IE 9]><html class="no-js lte-ie8"><![endif]-->
<!--[if (gt IE 8)|(gt IEMobile 7)|!(IEMobile)|!(IE)]><!--><html class="no-js" lang="en"><!--<![endif]-->
<head>
  <meta charset="utf-8">
  <title>Unit Tests. Data Provider без головной боли - fightmaster's blog</title>
  <meta name="author" content="fightmaster">

  
  <meta name="description" content="Недавно текущий проект перевалил за 1500 юнит тестов. Захотелось подвести какой-то итог. И сегодня не будет какого-то рецепта: &ldquo;А делайте так & &hellip;">
  

  <!-- http://t.co/dKP3o1e -->
  <meta name="HandheldFriendly" content="True">
  <meta name="MobileOptimized" content="320">
  <meta name="viewport" content="width=device-width, initial-scale=1">

  
  <link rel="canonical" href="http://fightmaster.github.io/blog/2013/10/05/unit-tests-data-provider-without-a-headache.html">
  <link href="/favicon.png" rel="icon">
  <link href="/stylesheets/screen.css" media="screen, projection" rel="stylesheet" type="text/css">
  <link href="/atom.xml" rel="alternate" title="fightmaster's blog" type="application/atom+xml">
  <script src="/javascripts/modernizr-2.0.js"></script>
  <script src="//ajax.googleapis.com/ajax/libs/jquery/1.9.1/jquery.min.js"></script>
  <script>!window.jQuery && document.write(unescape('%3Cscript src="./javascripts/libs/jquery.min.js"%3E%3C/script%3E'))</script>
  <script src="/javascripts/octopress.js" type="text/javascript"></script>
  <!--Fonts from Google"s Web font directory at http://google.com/webfonts -->
<link href="http://fonts.googleapis.com/css?family=PT+Serif:regular,italic,bold,bolditalic" rel="stylesheet" type="text/css">
<link href="http://fonts.googleapis.com/css?family=PT+Sans:regular,italic,bold,bolditalic" rel="stylesheet" type="text/css">

  
  <script type="text/javascript">
    var _gaq = _gaq || [];
    _gaq.push(['_setAccount', 'UA-38362255-1']);
    _gaq.push(['_trackPageview']);

    (function() {
      var ga = document.createElement('script'); ga.type = 'text/javascript'; ga.async = true;
      ga.src = ('https:' == document.location.protocol ? 'https://ssl' : 'http://www') + '.google-analytics.com/ga.js';
      var s = document.getElementsByTagName('script')[0]; s.parentNode.insertBefore(ga, s);
    })();
  </script>


</head>

<body   >
  <header role="banner"><hgroup>
  <h1><a href="/">fightmaster's blog</a></h1>
  
    <h2>Скромный персональный блог</h2>
  
</hgroup>

</header>
  <nav role="navigation"><ul class="subscription" data-subscription="rss">
  <li><a href="/atom.xml" rel="subscribe-rss" title="subscribe via RSS">RSS</a></li>
  
</ul>
  
<form action="http://google.com/search" method="get">
  <fieldset role="search">
    <input type="hidden" name="q" value="site:fightmaster.github.io" />
    <input class="search" type="text" name="q" results="0" placeholder="Search"/>
  </fieldset>
</form>
  
<ul class="main-navigation">
    <li><a href="/">Блог</a></li>
    <li><a href="/php-lectures/00-contents.html">Лекции по PHP</a></li>
    <li><a href="/blog/archives">Архив</a></li>
</ul>

</nav>
  <div id="main">
    <div id="content">
      <div>
<article class="hentry" role="article">
  
  <header>
    
      <h1 class="entry-title">Unit Tests. Data Provider без головной боли</h1>
    
    
      <p class="meta">
        








  


<time datetime="2013-10-05T01:00:00+04:00" pubdate data-updated="true">Oct 5<span>th</span>, 2013</time>
        
           | <a href="#disqus_thread"
             data-disqus-identifier="http://fightmaster.github.io">Comments</a>
        
      </p>
    
  </header>


<div class="entry-content"><p>Недавно текущий проект перевалил за 1500 юнит тестов. Захотелось подвести какой-то итог. И сегодня не будет какого-то рецепта: &ldquo;А делайте так &ndash; получите счастье&rdquo;. Посмотрим на примерах, как можно сделать что-то иначе. Внимание, очень много странных букв под php синтаксисом.</p>

<!-- more -->


<p>Мы с вами не на пробежке, разогреваться нам не надо, начнем сразу с кода. Примеры вымышленные, и я буду использовать аббревиатуру uut (Unit Under Test).</p>

<h3>isPositiveNumber($number)</h3>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
</pre></td><td class='code'><pre><code class='php'><span class='line'><span class="cp">&lt;?php</span>
</span><span class='line'><span class="k">public</span> <span class="k">function</span> <span class="nf">isPositiveNumber</span><span class="p">(</span><span class="nv">$number</span><span class="p">)</span>
</span><span class='line'><span class="p">{</span>
</span><span class='line'>    <span class="k">return</span> <span class="p">(</span><span class="nv">$number</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">)</span>
</span><span class='line'><span class="p">}</span>
</span><span class='line'><span class="cp">?&gt;</span><span class="x"></span>
</span></code></pre></td></tr></table></div></figure>


<p>Тест мог бы выглядеть так:</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
<span class='line-number'>15</span>
<span class='line-number'>16</span>
</pre></td><td class='code'><pre><code class='php'><span class='line'><span class="cp">&lt;?php</span>
</span><span class='line'><span class="sd">/**</span>
</span><span class='line'><span class="sd"> * @test</span>
</span><span class='line'><span class="sd"> */</span>
</span><span class='line'><span class="k">public</span> <span class="k">function</span> <span class="nf">isPositiveNumber</span><span class="p">()</span>
</span><span class='line'><span class="p">{</span>
</span><span class='line'>    <span class="nv">$result</span> <span class="o">=</span> <span class="nv">$this</span><span class="o">-&gt;</span><span class="na">uut</span><span class="o">-&gt;</span><span class="na">isPositiveNumber</span><span class="p">(</span><span class="mi">1</span><span class="p">);</span>
</span><span class='line'>    <span class="nv">$this</span><span class="o">-&gt;</span><span class="na">assertTrue</span><span class="p">(</span><span class="nv">$result</span><span class="p">);</span>
</span><span class='line'>
</span><span class='line'>    <span class="nv">$result</span> <span class="o">=</span> <span class="nv">$this</span><span class="o">-&gt;</span><span class="na">uut</span><span class="o">-&gt;</span><span class="na">isPositiveNumber</span><span class="p">(</span><span class="mi">0</span><span class="p">);</span>
</span><span class='line'>    <span class="nv">$this</span><span class="o">-&gt;</span><span class="na">assertFalse</span><span class="p">(</span><span class="nv">$result</span><span class="p">);</span>
</span><span class='line'>
</span><span class='line'>    <span class="nv">$result</span> <span class="o">=</span> <span class="nv">$this</span><span class="o">-&gt;</span><span class="na">uut</span><span class="o">-&gt;</span><span class="na">isPositiveNumber</span><span class="p">(</span><span class="o">-</span><span class="mi">1</span><span class="p">);</span>
</span><span class='line'>    <span class="nv">$this</span><span class="o">-&gt;</span><span class="na">assertFalse</span><span class="p">(</span><span class="nv">$result</span><span class="p">);</span>
</span><span class='line'><span class="p">}</span>
</span><span class='line'><span class="cp">?&gt;</span><span class="x"></span>
</span></code></pre></td></tr></table></div></figure>


<p>Или так:</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
<span class='line-number'>15</span>
<span class='line-number'>16</span>
<span class='line-number'>17</span>
<span class='line-number'>18</span>
<span class='line-number'>19</span>
<span class='line-number'>20</span>
<span class='line-number'>21</span>
<span class='line-number'>22</span>
</pre></td><td class='code'><pre><code class='php'><span class='line'><span class="cp">&lt;?php</span>
</span><span class='line'><span class="sd">/**</span>
</span><span class='line'><span class="sd"> * @test</span>
</span><span class='line'><span class="sd"> */</span>
</span><span class='line'><span class="k">public</span> <span class="k">function</span> <span class="nf">isPositiveNumberTrueScenario</span><span class="p">()</span>
</span><span class='line'><span class="p">{</span>
</span><span class='line'>    <span class="nv">$result</span> <span class="o">=</span> <span class="nv">$this</span><span class="o">-&gt;</span><span class="na">uut</span><span class="o">-&gt;</span><span class="na">isPositiveNumber</span><span class="p">(</span><span class="mi">1</span><span class="p">);</span>
</span><span class='line'>    <span class="nv">$this</span><span class="o">-&gt;</span><span class="na">assertTrue</span><span class="p">(</span><span class="nv">$result</span><span class="p">);</span>
</span><span class='line'><span class="p">}</span>
</span><span class='line'>
</span><span class='line'><span class="sd">/**</span>
</span><span class='line'><span class="sd"> * @test</span>
</span><span class='line'><span class="sd"> */</span>
</span><span class='line'><span class="k">public</span> <span class="k">function</span> <span class="nf">isPositiveNumberFalseScenario</span><span class="p">()</span>
</span><span class='line'><span class="p">{</span>
</span><span class='line'>    <span class="nv">$result</span> <span class="o">=</span> <span class="nv">$this</span><span class="o">-&gt;</span><span class="na">uut</span><span class="o">-&gt;</span><span class="na">isPositiveNumber</span><span class="p">(</span><span class="mi">0</span><span class="p">);</span>
</span><span class='line'>    <span class="nv">$this</span><span class="o">-&gt;</span><span class="na">assertFalse</span><span class="p">(</span><span class="nv">$result</span><span class="p">);</span>
</span><span class='line'>
</span><span class='line'>    <span class="nv">$result</span> <span class="o">=</span> <span class="nv">$this</span><span class="o">-&gt;</span><span class="na">uut</span><span class="o">-&gt;</span><span class="na">isPositiveNumber</span><span class="p">(</span><span class="o">-</span><span class="mi">1</span><span class="p">);</span>
</span><span class='line'>    <span class="nv">$this</span><span class="o">-&gt;</span><span class="na">assertFalse</span><span class="p">(</span><span class="nv">$result</span><span class="p">);</span>
</span><span class='line'><span class="p">}</span>
</span><span class='line'><span class="cp">?&gt;</span><span class="x"></span>
</span></code></pre></td></tr></table></div></figure>


<p>Мы пишем и пишем так тесты, пока кто-то не прочитает официальную документацию и не узнает, а что такое Data Providers: <a href="http://phpunit.de/manual/3.7/en/writing-tests-for-phpunit.html#writing-tests-for-phpunit.data-providers">phpunit.de</a>. Чаще всего нам необходимо протестировать метод с разными входными данными и проверить результат. Вот для избежания дублирования тестов и придумали эти провайдеры.</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
<span class='line-number'>15</span>
<span class='line-number'>16</span>
<span class='line-number'>17</span>
<span class='line-number'>18</span>
<span class='line-number'>19</span>
<span class='line-number'>20</span>
<span class='line-number'>21</span>
<span class='line-number'>22</span>
<span class='line-number'>23</span>
<span class='line-number'>24</span>
<span class='line-number'>25</span>
<span class='line-number'>26</span>
</pre></td><td class='code'><pre><code class='php'><span class='line'><span class="cp">&lt;?php</span>
</span><span class='line'><span class="sd">/**</span>
</span><span class='line'><span class="sd"> * @test</span>
</span><span class='line'><span class="sd"> * @dataProvider isPositiveNumberProvider</span>
</span><span class='line'><span class="sd"> *</span>
</span><span class='line'><span class="sd"> * @param integer $inputData</span>
</span><span class='line'><span class="sd"> * @param boolean $expectedResult</span>
</span><span class='line'><span class="sd"> */</span>
</span><span class='line'><span class="k">public</span> <span class="k">function</span> <span class="nf">isPositiveNumber</span><span class="p">(</span><span class="nv">$inputData</span><span class="p">,</span> <span class="nv">$expectedResult</span><span class="p">)</span>
</span><span class='line'><span class="p">{</span>
</span><span class='line'>    <span class="nv">$result</span> <span class="o">=</span> <span class="nv">$this</span><span class="o">-&gt;</span><span class="na">uut</span><span class="o">-&gt;</span><span class="na">isPositiveNumber</span><span class="p">(</span><span class="nv">$inputData</span><span class="p">);</span>
</span><span class='line'>    <span class="nv">$this</span><span class="o">-&gt;</span><span class="na">assertEquals</span><span class="p">(</span><span class="nv">$expectedResult</span><span class="p">,</span> <span class="nv">$result</span><span class="p">);</span>
</span><span class='line'><span class="p">}</span>
</span><span class='line'>
</span><span class='line'><span class="sd">/**</span>
</span><span class='line'><span class="sd"> * @return array</span>
</span><span class='line'><span class="sd"> */</span>
</span><span class='line'><span class="k">public</span> <span class="k">function</span> <span class="nf">isPositiveNumberProvider</span><span class="p">()</span>
</span><span class='line'><span class="p">{</span>
</span><span class='line'>    <span class="k">return</span> <span class="k">array</span><span class="p">(</span>
</span><span class='line'>        <span class="k">array</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="k">true</span><span class="p">),</span>
</span><span class='line'>        <span class="k">array</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="k">false</span><span class="p">),</span>
</span><span class='line'>        <span class="k">array</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="k">false</span><span class="p">)</span>
</span><span class='line'>    <span class="p">);</span>
</span><span class='line'><span class="p">}</span>
</span><span class='line'><span class="cp">?&gt;</span><span class="x"></span>
</span></code></pre></td></tr></table></div></figure>


<p>Кажется мы нашли решение для всего и плодим тесты одни за другим&hellip;</p>

<h3>Простота &ndash; залог успеха</h3>

<p>Написав первую главу, я понял, что не могу придумать адекватный пример для второй. А по ощущениям, я большую часть жизни так писал. Несколько дней искал объяснение этому факту. Пришел к выводу, что наш код со временем стал чище, и такие тесты практически вымерли.</p>

<p>Отступление&hellip; В день выпуска статьи у меня был небольшой митинг с коллегой, который завершился словами: &ldquo;Если разбить метод на три, как я предложил, то и с тестированием проблем не будет&rdquo;. Не могу утверждать, что мои слова действительно помогут, но они заставили меня еще раз задуматься о необходимости писать тесты.</p>

<p>Беря любой старый пример, я понимаю, что можно было написать по-другому. Или, как я недавно начал говорить, &ldquo;выпендриться&rdquo; и написать код мечты. Поэтому придется пойти на откровения дальше, взяв не самый хороший код из жизни.</p>

<h3>Юнит тесты поздней осенью</h3>

<p>Утро, поздняя осень, за окном холодно и темно. Вы приходите на работу в часов эдак семь или раньше. Идете на кухню, наливаете себе кофе, медленно и молчаливо пьете, с коллегой, девушкой, думая о том, что надо бы написать к коду тест.</p>

<p>Когда-то и кто-то что-то написал, дальше всем миром это апгрейдили, апгрейдили, а вчера вам пришлось снова что-то туда добавить. При этом вы были уставший, и вам срать было на этот старый код. Да и сейчас, наверное, особенно отношение не изменилось, просто ночью проснулся профессионализм.</p>

<p>Медленно мысли о &ldquo;надо написать&rdquo; перерастают в &ldquo;как написать&rdquo;. В голове прокручиваются воспоминания о том, а что же делает код. У вас есть некие данные, из которых собирается какая-то сущность. При этом накладывается куча всевозможных &ldquo;бизнес&rdquo; ограничений на входную информацию. Что-то вроде сахар не может быть синим, а картошка не может доставлена в ресторан без лука, а помол кофе может быть лишь трех видов, а третий вид поставляется только из Африки. Вроде и валидация, а с другой стороны ничего стандартного не прикрепишь.</p>

<p>В итоге в отведенные два часа из трех вы вчера написали что-то наподобие этому, plain php.</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
<span class='line-number'>15</span>
<span class='line-number'>16</span>
<span class='line-number'>17</span>
<span class='line-number'>18</span>
</pre></td><td class='code'><pre><code class='php'><span class='line'><span class="cp">&lt;?php</span>
</span><span class='line'><span class="sd">/**</span>
</span><span class='line'><span class="sd"> * @param Model $model</span>
</span><span class='line'><span class="sd"> * @throws CustomException</span>
</span><span class='line'><span class="sd"> */</span>
</span><span class='line'><span class="k">protected</span> <span class="k">function</span> <span class="nf">checkSomethingRestrictions</span><span class="p">(</span><span class="nx">Model</span> <span class="nv">$model</span><span class="p">)</span>
</span><span class='line'><span class="p">{</span>
</span><span class='line'>    <span class="nv">$linkedModel</span> <span class="o">=</span> <span class="nv">$model</span><span class="o">-&gt;</span><span class="na">getLinkedModel</span><span class="p">();</span>
</span><span class='line'>    <span class="k">if</span> <span class="p">(</span><span class="nv">$linkedModel</span> <span class="o">&amp;&amp;</span> <span class="nv">$model</span><span class="o">-&gt;</span><span class="na">hasSomething</span><span class="p">())</span> <span class="p">{</span>
</span><span class='line'>        <span class="k">throw</span> <span class="k">new</span> <span class="nx">CustomException</span><span class="p">(</span><span class="s1">&#39;Failed 1&#39;</span><span class="p">,</span> <span class="mi">1</span><span class="p">);</span>
</span><span class='line'>    <span class="p">}</span>
</span><span class='line'>
</span><span class='line'>    <span class="c1">//code - code - code</span>
</span><span class='line'>
</span><span class='line'>    <span class="k">if</span> <span class="p">(</span><span class="nv">$model</span><span class="o">-&gt;</span><span class="na">isEnabled</span><span class="p">()</span> <span class="o">&amp;&amp;</span> <span class="nv">$something</span> <span class="o">==</span> <span class="k">false</span><span class="p">)</span> <span class="p">{</span>
</span><span class='line'>        <span class="k">throw</span> <span class="k">new</span> <span class="nx">CustomException</span><span class="p">(</span><span class="s1">&#39;Failed 17&#39;</span><span class="p">,</span> <span class="mi">17</span><span class="p">);</span>
</span><span class='line'>    <span class="p">}</span>
</span><span class='line'><span class="cp">?&gt;</span><span class="x"></span>
</span></code></pre></td></tr></table></div></figure>


<p>Проснувшись и преодолев чувство стыда за написанное, вы пишите быстренько тест.</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
<span class='line-number'>15</span>
<span class='line-number'>16</span>
<span class='line-number'>17</span>
<span class='line-number'>18</span>
<span class='line-number'>19</span>
<span class='line-number'>20</span>
<span class='line-number'>21</span>
<span class='line-number'>22</span>
<span class='line-number'>23</span>
<span class='line-number'>24</span>
<span class='line-number'>25</span>
<span class='line-number'>26</span>
<span class='line-number'>27</span>
<span class='line-number'>28</span>
<span class='line-number'>29</span>
<span class='line-number'>30</span>
<span class='line-number'>31</span>
<span class='line-number'>32</span>
<span class='line-number'>33</span>
<span class='line-number'>34</span>
<span class='line-number'>35</span>
<span class='line-number'>36</span>
<span class='line-number'>37</span>
<span class='line-number'>38</span>
<span class='line-number'>39</span>
<span class='line-number'>40</span>
<span class='line-number'>41</span>
<span class='line-number'>42</span>
<span class='line-number'>43</span>
<span class='line-number'>44</span>
<span class='line-number'>45</span>
<span class='line-number'>46</span>
<span class='line-number'>47</span>
<span class='line-number'>48</span>
<span class='line-number'>49</span>
<span class='line-number'>50</span>
<span class='line-number'>51</span>
<span class='line-number'>52</span>
<span class='line-number'>53</span>
<span class='line-number'>54</span>
</pre></td><td class='code'><pre><code class='php'><span class='line'><span class="cp">&lt;?php</span>
</span><span class='line'><span class="sd">/**</span>
</span><span class='line'><span class="sd"> * @test</span>
</span><span class='line'><span class="sd"> * @dataProvider checkSomethingRestrictionsProvider</span>
</span><span class='line'><span class="sd"> *</span>
</span><span class='line'><span class="sd"> * @param string $modelReference</span>
</span><span class='line'><span class="sd"> * @param string $exceptionMessage</span>
</span><span class='line'><span class="sd"> * @param integer|null $exceptionCode</span>
</span><span class='line'><span class="sd"> */</span>
</span><span class='line'><span class="k">public</span> <span class="k">function</span> <span class="nf">checkSomethingRestrictions</span><span class="p">(</span><span class="nv">$modelReference</span><span class="p">,</span> <span class="nv">$exceptionMessage</span> <span class="o">=</span> <span class="k">null</span><span class="p">,</span> <span class="nv">$exceptionCode</span> <span class="o">=</span> <span class="k">null</span><span class="p">)</span>
</span><span class='line'><span class="p">{</span>
</span><span class='line'>    <span class="k">if</span> <span class="p">(</span><span class="nv">$exceptionMessage</span> <span class="o">!==</span> <span class="k">null</span> <span class="o">||</span> <span class="nv">$exceptionCode</span> <span class="o">!==</span> <span class="k">null</span><span class="p">)</span> <span class="p">{</span>
</span><span class='line'>        <span class="nv">$this</span><span class="o">-&gt;</span><span class="na">setExpectedException</span><span class="p">(</span><span class="s1">&#39;CustomException&#39;</span><span class="p">,</span> <span class="nv">$exceptionMessage</span><span class="p">,</span> <span class="nv">$exceptionCode</span><span class="p">);</span>
</span><span class='line'>    <span class="p">}</span>
</span><span class='line'>
</span><span class='line'>    <span class="nv">$model</span> <span class="o">=</span> <span class="nv">$this</span><span class="o">-&gt;</span><span class="na">referenceRepository</span><span class="o">-&gt;</span><span class="na">getReference</span><span class="p">(</span><span class="nv">$modelReference</span><span class="p">);</span>
</span><span class='line'>    <span class="nv">$this</span><span class="o">-&gt;</span><span class="na">uut</span><span class="o">-&gt;</span><span class="na">checkSomethingRestrictions</span><span class="p">(</span><span class="nv">$model</span><span class="p">);</span>
</span><span class='line'><span class="p">}</span>
</span><span class='line'>
</span><span class='line'><span class="sd">/**</span>
</span><span class='line'><span class="sd"> * @return array</span>
</span><span class='line'><span class="sd"> */</span>
</span><span class='line'><span class="k">public</span> <span class="k">function</span> <span class="nf">checkSomethingRestrictionsProvider</span><span class="p">()</span>
</span><span class='line'><span class="p">{</span>
</span><span class='line'>    <span class="k">return</span> <span class="k">array</span><span class="p">(</span>
</span><span class='line'>        <span class="k">array</span><span class="p">(</span><span class="s1">&#39;model_1&#39;</span><span class="p">),</span>
</span><span class='line'>        <span class="k">array</span><span class="p">(</span><span class="s1">&#39;model_2&#39;</span><span class="p">),</span>
</span><span class='line'>        <span class="k">array</span><span class="p">(</span><span class="s1">&#39;model_3&#39;</span><span class="p">),</span>
</span><span class='line'>        <span class="k">array</span><span class="p">(</span><span class="s1">&#39;model_4&#39;</span><span class="p">),</span>
</span><span class='line'>        <span class="k">array</span><span class="p">(</span><span class="s1">&#39;model_5&#39;</span><span class="p">),</span>
</span><span class='line'>        <span class="k">array</span><span class="p">(</span><span class="s1">&#39;model_6&#39;</span><span class="p">),</span>
</span><span class='line'>        <span class="k">array</span><span class="p">(</span><span class="s1">&#39;model_7&#39;</span><span class="p">),</span>
</span><span class='line'>        <span class="k">array</span><span class="p">(</span><span class="s1">&#39;model_8&#39;</span><span class="p">),</span>
</span><span class='line'>        <span class="k">array</span><span class="p">(</span><span class="s1">&#39;model_9&#39;</span><span class="p">),</span>
</span><span class='line'>        <span class="k">array</span><span class="p">(</span><span class="s1">&#39;invalid_model_1&#39;</span><span class="p">,</span> <span class="s1">&#39;Failed 1&#39;</span><span class="p">,</span> <span class="mi">1</span><span class="p">),</span>
</span><span class='line'>        <span class="k">array</span><span class="p">(</span><span class="s1">&#39;invalid_model_2&#39;</span><span class="p">,</span> <span class="s1">&#39;Failed 2&#39;</span><span class="p">,</span> <span class="mi">2</span><span class="p">),</span>
</span><span class='line'>        <span class="k">array</span><span class="p">(</span><span class="s1">&#39;invalid_model_3&#39;</span><span class="p">,</span> <span class="s1">&#39;Failed 3&#39;</span><span class="p">,</span> <span class="mi">3</span><span class="p">),</span>
</span><span class='line'>        <span class="k">array</span><span class="p">(</span><span class="s1">&#39;invalid_model_5&#39;</span><span class="p">,</span> <span class="s1">&#39;Failed 5&#39;</span><span class="p">,</span> <span class="mi">5</span><span class="p">),</span>
</span><span class='line'>        <span class="k">array</span><span class="p">(</span><span class="s1">&#39;invalid_model_4&#39;</span><span class="p">,</span> <span class="s1">&#39;Failed 4&#39;</span><span class="p">,</span> <span class="mi">4</span><span class="p">),</span>
</span><span class='line'>        <span class="k">array</span><span class="p">(</span><span class="s1">&#39;invalid_model_6&#39;</span><span class="p">,</span> <span class="s1">&#39;Failed 6&#39;</span><span class="p">,</span> <span class="mi">6</span><span class="p">),</span>
</span><span class='line'>        <span class="k">array</span><span class="p">(</span><span class="s1">&#39;invalid_model_7&#39;</span><span class="p">,</span> <span class="s1">&#39;Failed 7&#39;</span><span class="p">,</span> <span class="mi">7</span><span class="p">),</span>
</span><span class='line'>        <span class="k">array</span><span class="p">(</span><span class="s1">&#39;invalid_model_8&#39;</span><span class="p">,</span> <span class="s1">&#39;Failed 8&#39;</span><span class="p">,</span> <span class="mi">8</span><span class="p">),</span>
</span><span class='line'>        <span class="k">array</span><span class="p">(</span><span class="s1">&#39;invalid_model_9&#39;</span><span class="p">,</span> <span class="s1">&#39;Failed 9&#39;</span><span class="p">,</span> <span class="mi">9</span><span class="p">),</span>
</span><span class='line'>        <span class="k">array</span><span class="p">(</span><span class="s1">&#39;invalid_model_10&#39;</span><span class="p">,</span> <span class="s1">&#39;Failed 10&#39;</span><span class="p">,</span> <span class="mi">10</span><span class="p">),</span>
</span><span class='line'>        <span class="k">array</span><span class="p">(</span><span class="s1">&#39;invalid_model_11&#39;</span><span class="p">,</span> <span class="s1">&#39;Failed 11&#39;</span><span class="p">,</span> <span class="mi">11</span><span class="p">),</span>
</span><span class='line'>        <span class="k">array</span><span class="p">(</span><span class="s1">&#39;invalid_model_12&#39;</span><span class="p">,</span> <span class="s1">&#39;Failed 12&#39;</span><span class="p">,</span> <span class="mi">12</span><span class="p">),</span>
</span><span class='line'>        <span class="k">array</span><span class="p">(</span><span class="s1">&#39;invalid_model_13&#39;</span><span class="p">,</span> <span class="s1">&#39;Failed 13&#39;</span><span class="p">,</span> <span class="mi">13</span><span class="p">),</span>
</span><span class='line'>        <span class="k">array</span><span class="p">(</span><span class="s1">&#39;invalid_model_14&#39;</span><span class="p">,</span> <span class="s1">&#39;Failed 14&#39;</span><span class="p">,</span> <span class="mi">14</span><span class="p">),</span>
</span><span class='line'>        <span class="k">array</span><span class="p">(</span><span class="s1">&#39;invalid_model_15&#39;</span><span class="p">,</span> <span class="s1">&#39;Failed 15&#39;</span><span class="p">,</span> <span class="mi">15</span><span class="p">),</span>
</span><span class='line'>        <span class="k">array</span><span class="p">(</span><span class="s1">&#39;invalid_model_16&#39;</span><span class="p">,</span> <span class="s1">&#39;Failed 16&#39;</span><span class="p">,</span> <span class="mi">16</span><span class="p">),</span>
</span><span class='line'>        <span class="k">array</span><span class="p">(</span><span class="s1">&#39;invalid_model_17&#39;</span><span class="p">,</span> <span class="s1">&#39;Failed 17&#39;</span><span class="p">,</span> <span class="mi">17</span><span class="p">)</span>
</span><span class='line'>    <span class="p">);</span>
</span><span class='line'><span class="p">}</span>
</span><span class='line'><span class="cp">?&gt;</span><span class="x"></span>
</span></code></pre></td></tr></table></div></figure>


<p>Конечно, слово &ldquo;быстро&rdquo; не совсем к месту. Создали кучу фикстур для тестирования различных ситуаций и закомитили.</p>

<p>К сожалению, пример попал в 7 или 8 из 10. Имена переменных вымышленные, но размер дата провайдера совершенно реален.</p>

<p>Тут самое время вернуться к статье о <a href="fightmaster.github.io/blog/2013/09/25/code-review.html">код ревью</a>. Система код ревью &ndash; это машина будущего, она переносит ваших коллег на полгода вперед, тем самым предоставляя возможность изменить ход событий, избежать тупления над кодом и тестом.</p>

<blockquote><p>При написании кода мы стараемся дать сразу понять: что делает метод, что возвращает, что хранит переменная и т.д.. </p><p>При написании теста мы стараемся показать сразу: что тестируем и какую ситуацию описывают входные данные и т.д..</p><footer><strong>fightmaster</strong> <cite><a href='http://fightmaster.github.io/blog/2013/09/23/unit-tests.html'>fightmaster.github.io/blog/2013/&hellip;</a></cite></footer></blockquote>


<p>И правда, а что тестируется в итоге? Вот упадет через полгода код на 15 варианте дата провайдера, и чем мне это поможет? Название какой-то фикстуры (о хорошем тоне именования фикстур в следующей серии) ни о чем нам не скажет. Ну пойдем, откроем ее, а дальше что? А вдруг Петя ее поменял, а за ним Саша. А кто из них был не прав? А вдруг в нашей системе изменились требования, и именно этот тест теперь не должен падать при таких условиях. В обшем ничерта непонятно.</p>

<p>Вторая сторона, это добавить что-то в тест. Мы не знаем куда именно добавлять наш вариант. Все равно куда &ndash; не дело. А может наш вариант уже добавлен?</p>

<p>Первое и самое простое, что приходит в голову, оставить просто пояснения, в двух или трех словах выражающие особенность этого кейса.</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
<span class='line-number'>15</span>
<span class='line-number'>16</span>
<span class='line-number'>17</span>
<span class='line-number'>18</span>
<span class='line-number'>19</span>
<span class='line-number'>20</span>
<span class='line-number'>21</span>
<span class='line-number'>22</span>
<span class='line-number'>23</span>
<span class='line-number'>24</span>
<span class='line-number'>25</span>
<span class='line-number'>26</span>
<span class='line-number'>27</span>
<span class='line-number'>28</span>
<span class='line-number'>29</span>
<span class='line-number'>30</span>
<span class='line-number'>31</span>
<span class='line-number'>32</span>
<span class='line-number'>33</span>
<span class='line-number'>34</span>
<span class='line-number'>35</span>
<span class='line-number'>36</span>
<span class='line-number'>37</span>
<span class='line-number'>38</span>
</pre></td><td class='code'><pre><code class='php'><span class='line'><span class="cp">&lt;?php</span>
</span><span class='line'>
</span><span class='line'><span class="sd">/**</span>
</span><span class='line'><span class="sd"> * @return array</span>
</span><span class='line'><span class="sd"> */</span>
</span><span class='line'><span class="k">public</span> <span class="k">function</span> <span class="nf">checkSomethingRestrictionsProvider</span><span class="p">()</span>
</span><span class='line'><span class="p">{</span>
</span><span class='line'>    <span class="k">return</span> <span class="k">array</span><span class="p">(</span>
</span><span class='line'>        <span class="c1">// model 1, pass</span>
</span><span class='line'>        <span class="k">array</span><span class="p">(</span><span class="s1">&#39;model_1&#39;</span><span class="p">),</span>
</span><span class='line'>        <span class="c1">// model 2, pass</span>
</span><span class='line'>        <span class="k">array</span><span class="p">(</span><span class="s1">&#39;model_2&#39;</span><span class="p">),</span>
</span><span class='line'>
</span><span class='line'>        <span class="c1">// code</span>
</span><span class='line'>        <span class="c1">// code</span>
</span><span class='line'>
</span><span class='line'>        <span class="k">array</span><span class="p">(</span><span class="s1">&#39;model_7&#39;</span><span class="p">),</span>
</span><span class='line'>        <span class="c1">// model 8, pass</span>
</span><span class='line'>        <span class="k">array</span><span class="p">(</span><span class="s1">&#39;model_8&#39;</span><span class="p">),</span>
</span><span class='line'>        <span class="c1">// model 9, pass</span>
</span><span class='line'>        <span class="k">array</span><span class="p">(</span><span class="s1">&#39;model_9&#39;</span><span class="p">),</span>
</span><span class='line'>        <span class="c1">// model 1, unknown attribute, fail</span>
</span><span class='line'>        <span class="k">array</span><span class="p">(</span><span class="s1">&#39;invalid_model_1&#39;</span><span class="p">,</span> <span class="s1">&#39;Failed 1&#39;</span><span class="p">,</span> <span class="mi">1</span><span class="p">),</span>
</span><span class='line'>        <span class="c1">// model 2, unknown name, fail</span>
</span><span class='line'>        <span class="k">array</span><span class="p">(</span><span class="s1">&#39;invalid_model_2&#39;</span><span class="p">,</span> <span class="s1">&#39;Failed 2&#39;</span><span class="p">,</span> <span class="mi">2</span><span class="p">),</span>
</span><span class='line'>        <span class="c1">// model 3, no assign balck color, fail</span>
</span><span class='line'>        <span class="k">array</span><span class="p">(</span><span class="s1">&#39;invalid_model_3&#39;</span><span class="p">,</span> <span class="s1">&#39;Failed 3&#39;</span><span class="p">,</span> <span class="mi">3</span><span class="p">),</span>
</span><span class='line'>
</span><span class='line'>        <span class="c1">// code</span>
</span><span class='line'>        <span class="c1">// code</span>
</span><span class='line'>
</span><span class='line'>        <span class="c1">// model 16, unknown name, fail</span>
</span><span class='line'>        <span class="k">array</span><span class="p">(</span><span class="s1">&#39;invalid_model_16&#39;</span><span class="p">,</span> <span class="s1">&#39;Failed 16&#39;</span><span class="p">,</span> <span class="mi">16</span><span class="p">),</span>
</span><span class='line'>        <span class="c1">// product WITH color specified, fail</span>
</span><span class='line'>        <span class="k">array</span><span class="p">(</span><span class="s1">&#39;invalid_model_17&#39;</span><span class="p">,</span> <span class="s1">&#39;Failed 17&#39;</span><span class="p">,</span> <span class="mi">17</span><span class="p">)</span>
</span><span class='line'>    <span class="p">);</span>
</span><span class='line'><span class="p">}</span>
</span><span class='line'><span class="cp">?&gt;</span><span class="x"></span>
</span></code></pre></td></tr></table></div></figure>


<p>Теперь мы хотя бы знаем, что хотели сказать авторы. Поддерживать тест теперь намного проще, порог вхождения в код сокращен.</p>

<h3>Бесконечность параметров</h3>

<p>В первых строках этой главы я завис на несколько минут. Все дело в том, что я очень редко вижу методы с большим набором входных параметров. Все знают, что это имеет плачевные последствия, и никто так не пишет нынче. Но почему-то все забывают эти правила при написании тестов. Мне кажется это феномен. Я наблюдал это в других проектах. Да, и где-то в глубине души существует искра надежды, что вы делали также.</p>

<p>Чаще всего в тесте нам нужно сконфигурировать определенную ситуацию. В предыдущей главе это достигалось с помощью фикстур. Часто используются моки или даже сами объекты, последнее конечно неправильно. Но в данных примерах именно они и будут. Так как работа с мок объектами &ndash; это целое искуство, и я не хочу все смешивать.</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
<span class='line-number'>15</span>
<span class='line-number'>16</span>
<span class='line-number'>17</span>
<span class='line-number'>18</span>
<span class='line-number'>19</span>
<span class='line-number'>20</span>
<span class='line-number'>21</span>
<span class='line-number'>22</span>
<span class='line-number'>23</span>
<span class='line-number'>24</span>
<span class='line-number'>25</span>
<span class='line-number'>26</span>
<span class='line-number'>27</span>
<span class='line-number'>28</span>
<span class='line-number'>29</span>
<span class='line-number'>30</span>
<span class='line-number'>31</span>
</pre></td><td class='code'><pre><code class='php'><span class='line'><span class="cp">&lt;?php</span>
</span><span class='line'><span class="sd">/**</span>
</span><span class='line'><span class="sd"> * @test</span>
</span><span class='line'><span class="sd"> * @backupGlobals enabled</span>
</span><span class='line'><span class="sd"> * @dataProvider getGlobalsProvider</span>
</span><span class='line'><span class="sd"> * </span>
</span><span class='line'><span class="sd"> * @param boolean $a</span>
</span><span class='line'><span class="sd"> * @param boolean $b</span>
</span><span class='line'><span class="sd"> * @param array $expectedResult</span>
</span><span class='line'><span class="sd"> */</span>
</span><span class='line'><span class="k">public</span> <span class="k">function</span> <span class="nf">getGlobals</span><span class="p">(</span><span class="nv">$a</span><span class="p">,</span> <span class="nv">$b</span><span class="p">,</span> <span class="nv">$expectedResult</span><span class="p">)</span>
</span><span class='line'><span class="p">{</span>
</span><span class='line'>    <span class="nv">$GLOBALS</span><span class="p">[</span><span class="s1">&#39;a&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="nv">$a</span><span class="p">;</span>
</span><span class='line'>    <span class="nv">$GLOBALS</span><span class="p">[</span><span class="s1">&#39;b&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="nv">$b</span><span class="p">;</span>
</span><span class='line'>    <span class="nv">$result</span> <span class="o">=</span> <span class="nv">$this</span><span class="o">-&gt;</span><span class="na">uut</span><span class="o">-&gt;</span><span class="na">getGlobals</span><span class="p">();</span>
</span><span class='line'>    <span class="nv">$this</span><span class="o">-&gt;</span><span class="na">assertSame</span><span class="p">(</span><span class="nv">$expectedResult</span><span class="p">,</span> <span class="nv">$result</span><span class="p">);</span>
</span><span class='line'><span class="p">}</span>
</span><span class='line'>
</span><span class='line'><span class="sd">/**</span>
</span><span class='line'><span class="sd"> * @return array</span>
</span><span class='line'><span class="sd"> */</span>
</span><span class='line'><span class="k">public</span> <span class="k">function</span> <span class="nf">getGlobalsProvider</span><span class="p">()</span>
</span><span class='line'><span class="p">{</span>
</span><span class='line'>    <span class="k">return</span> <span class="k">array</span><span class="p">(</span>
</span><span class='line'>        <span class="k">array</span><span class="p">(</span><span class="k">true</span><span class="p">,</span> <span class="k">true</span><span class="p">,</span> <span class="k">array</span><span class="p">(</span><span class="s1">&#39;a_value&#39;</span> <span class="o">=&gt;</span> <span class="k">true</span><span class="p">,</span> <span class="s1">&#39;b_value&#39;</span> <span class="o">=&gt;</span> <span class="k">true</span><span class="p">)),</span>
</span><span class='line'>        <span class="k">array</span><span class="p">(</span><span class="k">true</span><span class="p">,</span> <span class="k">false</span><span class="p">,</span> <span class="k">array</span><span class="p">(</span><span class="s1">&#39;a_value&#39;</span> <span class="o">=&gt;</span> <span class="k">true</span><span class="p">,</span> <span class="s1">&#39;b_value&#39;</span> <span class="o">=&gt;</span> <span class="k">false</span><span class="p">)),</span>
</span><span class='line'>        <span class="k">array</span><span class="p">(</span><span class="k">false</span><span class="p">,</span> <span class="k">true</span><span class="p">,</span> <span class="k">array</span><span class="p">(</span><span class="s1">&#39;a_value&#39;</span> <span class="o">=&gt;</span> <span class="k">false</span><span class="p">,</span> <span class="s1">&#39;b_value&#39;</span> <span class="o">=&gt;</span> <span class="k">true</span><span class="p">)),</span>
</span><span class='line'>        <span class="k">array</span><span class="p">(</span><span class="k">false</span><span class="p">,</span> <span class="k">false</span><span class="p">,</span> <span class="k">array</span><span class="p">(</span><span class="s1">&#39;a_value&#39;</span> <span class="o">=&gt;</span> <span class="k">false</span><span class="p">,</span> <span class="s1">&#39;b_value&#39;</span> <span class="o">=&gt;</span> <span class="k">false</span><span class="p">)),</span>
</span><span class='line'>    <span class="p">);</span>
</span><span class='line'><span class="p">}</span>
</span><span class='line'><span class="cp">?&gt;</span><span class="x"></span>
</span></code></pre></td></tr></table></div></figure>


<p>Такой вот незамысловатый пример. Через некоторое время использование дата провайдера таким образом превращается в привычку. И в результате&hellip;</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
<span class='line-number'>15</span>
<span class='line-number'>16</span>
<span class='line-number'>17</span>
<span class='line-number'>18</span>
<span class='line-number'>19</span>
<span class='line-number'>20</span>
<span class='line-number'>21</span>
<span class='line-number'>22</span>
<span class='line-number'>23</span>
<span class='line-number'>24</span>
<span class='line-number'>25</span>
<span class='line-number'>26</span>
<span class='line-number'>27</span>
<span class='line-number'>28</span>
<span class='line-number'>29</span>
<span class='line-number'>30</span>
<span class='line-number'>31</span>
<span class='line-number'>32</span>
<span class='line-number'>33</span>
<span class='line-number'>34</span>
<span class='line-number'>35</span>
<span class='line-number'>36</span>
<span class='line-number'>37</span>
<span class='line-number'>38</span>
<span class='line-number'>39</span>
<span class='line-number'>40</span>
<span class='line-number'>41</span>
<span class='line-number'>42</span>
<span class='line-number'>43</span>
<span class='line-number'>44</span>
<span class='line-number'>45</span>
<span class='line-number'>46</span>
<span class='line-number'>47</span>
<span class='line-number'>48</span>
<span class='line-number'>49</span>
<span class='line-number'>50</span>
<span class='line-number'>51</span>
<span class='line-number'>52</span>
<span class='line-number'>53</span>
<span class='line-number'>54</span>
<span class='line-number'>55</span>
<span class='line-number'>56</span>
<span class='line-number'>57</span>
<span class='line-number'>58</span>
<span class='line-number'>59</span>
<span class='line-number'>60</span>
</pre></td><td class='code'><pre><code class='php'><span class='line'><span class="cp">&lt;?php</span>
</span><span class='line'><span class="sd">/**</span>
</span><span class='line'><span class="sd"> * @test</span>
</span><span class='line'><span class="sd"> * @dataProvider findBySearchMappingProvider</span>
</span><span class='line'><span class="sd"> *</span>
</span><span class='line'><span class="sd"> * @param string|null $color</span>
</span><span class='line'><span class="sd"> * @param string|null $size</span>
</span><span class='line'><span class="sd"> * @param integer|null $width</span>
</span><span class='line'><span class="sd"> * @param integer|null $length</span>
</span><span class='line'><span class="sd"> * @param integer|null $height</span>
</span><span class='line'><span class="sd"> * @param boolean|null $enabled</span>
</span><span class='line'><span class="sd"> * @param array $expectedReferences</span>
</span><span class='line'><span class="sd"> * @param integer $expectedResultCount</span>
</span><span class='line'><span class="sd"> */</span>
</span><span class='line'><span class="k">public</span> <span class="k">function</span> <span class="nf">findBySearchMapping</span><span class="p">(</span><span class="nv">$color</span><span class="p">,</span> <span class="nv">$size</span><span class="p">,</span> <span class="nv">$width</span><span class="p">,</span> <span class="nv">$length</span><span class="p">,</span> <span class="nv">$height</span><span class="p">,</span> <span class="nv">$enabled</span><span class="p">,</span> <span class="nv">$expectedReferences</span><span class="p">,</span> <span class="nv">$expectedResultCount</span><span class="p">)</span>
</span><span class='line'><span class="p">{</span>
</span><span class='line'>    <span class="nv">$expectedResults</span> <span class="o">=</span> <span class="k">array</span><span class="p">();</span>
</span><span class='line'>    <span class="k">foreach</span> <span class="p">(</span><span class="nv">$expectedReferences</span> <span class="k">as</span> <span class="nv">$referenceName</span><span class="p">)</span> <span class="p">{</span>
</span><span class='line'>        <span class="nv">$expectedResults</span><span class="p">[]</span> <span class="o">=</span> <span class="nv">$this</span><span class="o">-&gt;</span><span class="na">referenceRepository</span><span class="o">-&gt;</span><span class="na">getReference</span><span class="p">(</span><span class="nv">$referenceName</span><span class="p">);</span>
</span><span class='line'>    <span class="p">}</span>
</span><span class='line'>
</span><span class='line'>    <span class="nv">$searchMapping</span> <span class="o">=</span> <span class="k">new</span> <span class="nx">SearchMapping</span><span class="p">();</span>
</span><span class='line'>    <span class="nv">$searchMapping</span><span class="o">-&gt;</span><span class="na">setColor</span><span class="p">(</span><span class="nv">$color</span><span class="p">)</span>
</span><span class='line'>        <span class="o">-&gt;</span><span class="na">setSize</span><span class="p">(</span><span class="nv">$size</span><span class="p">)</span>
</span><span class='line'>        <span class="o">-&gt;</span><span class="na">setWidth</span><span class="p">(</span><span class="nv">$width</span><span class="p">)</span>
</span><span class='line'>        <span class="o">-&gt;</span><span class="na">setLength</span><span class="p">(</span><span class="nv">$length</span><span class="p">)</span>
</span><span class='line'>        <span class="o">-&gt;</span><span class="na">setHeight</span><span class="p">(</span><span class="nv">$height</span><span class="p">)</span>
</span><span class='line'>        <span class="o">-&gt;</span><span class="na">setEnabled</span><span class="p">(</span><span class="nv">$enabled</span><span class="p">);</span>
</span><span class='line'>
</span><span class='line'>    <span class="nv">$results</span> <span class="o">=</span> <span class="nv">$this</span><span class="o">-&gt;</span><span class="na">uut</span><span class="o">-&gt;</span><span class="na">findBySearchMapping</span><span class="p">(</span><span class="nv">$searchMapping</span><span class="p">);</span>
</span><span class='line'>
</span><span class='line'>    <span class="nv">$this</span><span class="o">-&gt;</span><span class="na">assertCount</span><span class="p">(</span><span class="nv">$expectedResultCount</span><span class="p">,</span> <span class="nv">$results</span><span class="p">);</span>
</span><span class='line'>    <span class="nv">$this</span><span class="o">-&gt;</span><span class="na">assertContainsOnlyInstancesOf</span><span class="p">(</span><span class="s1">&#39;SomeInterface&#39;</span><span class="p">,</span> <span class="nv">$results</span><span class="p">);</span>
</span><span class='line'>    <span class="nv">$this</span><span class="o">-&gt;</span><span class="na">assertEquals</span><span class="p">(</span><span class="nv">$expectedResults</span><span class="p">,</span> <span class="nv">$results</span><span class="p">);</span>
</span><span class='line'><span class="p">}</span>
</span><span class='line'>
</span><span class='line'><span class="sd">/**</span>
</span><span class='line'><span class="sd"> * @return array</span>
</span><span class='line'><span class="sd"> */</span>
</span><span class='line'><span class="k">public</span> <span class="k">function</span> <span class="nf">findBySearchMappingProvider</span><span class="p">()</span>
</span><span class='line'><span class="p">{</span>
</span><span class='line'>    <span class="k">return</span> <span class="k">array</span><span class="p">(</span>
</span><span class='line'>        <span class="k">array</span><span class="p">(</span><span class="k">null</span><span class="p">,</span> <span class="k">null</span><span class="p">,</span> <span class="k">null</span><span class="p">,</span> <span class="k">null</span><span class="p">,</span> <span class="k">null</span><span class="p">,</span> <span class="k">null</span><span class="p">,</span> <span class="k">array</span><span class="p">(</span><span class="s1">&#39;model_1&#39;</span><span class="p">,</span> <span class="s1">&#39;model_2&#39;</span><span class="p">,</span> <span class="s1">&#39;model_3&#39;</span><span class="p">,</span> <span class="s1">&#39;model_4&#39;</span><span class="p">,</span> <span class="s1">&#39;model_5&#39;</span><span class="p">,</span> <span class="s1">&#39;model_6&#39;</span><span class="p">),</span> <span class="mi">6</span><span class="p">),</span>
</span><span class='line'>        <span class="k">array</span><span class="p">(</span><span class="s1">&#39;black&#39;</span><span class="p">,</span> <span class="k">null</span><span class="p">,</span> <span class="k">null</span><span class="p">,</span> <span class="k">null</span><span class="p">,</span> <span class="k">null</span><span class="p">,</span> <span class="k">null</span><span class="p">,</span> <span class="k">array</span><span class="p">(</span><span class="s1">&#39;model_1&#39;</span><span class="p">),</span> <span class="mi">1</span><span class="p">),</span>
</span><span class='line'>        <span class="k">array</span><span class="p">(</span><span class="s1">&#39;red&#39;</span><span class="p">,</span> <span class="k">null</span><span class="p">,</span> <span class="k">null</span><span class="p">,</span> <span class="k">null</span><span class="p">,</span> <span class="k">null</span><span class="p">,</span> <span class="k">null</span><span class="p">,</span> <span class="k">array</span><span class="p">(</span><span class="s1">&#39;model_2&#39;</span><span class="p">),</span> <span class="mi">1</span><span class="p">),</span>
</span><span class='line'>        <span class="k">array</span><span class="p">(</span><span class="s1">&#39;NOTEXIST&#39;</span><span class="p">,</span> <span class="k">null</span><span class="p">,</span> <span class="k">null</span><span class="p">,</span> <span class="k">null</span><span class="p">,</span> <span class="k">null</span><span class="p">,</span> <span class="k">null</span><span class="p">,</span> <span class="k">array</span><span class="p">(),</span> <span class="mi">0</span><span class="p">),</span>
</span><span class='line'>        <span class="k">array</span><span class="p">(</span><span class="k">null</span><span class="p">,</span> <span class="s1">&#39;XL&#39;</span><span class="p">,</span> <span class="k">null</span><span class="p">,</span> <span class="k">null</span><span class="p">,</span> <span class="k">null</span><span class="p">,</span> <span class="k">null</span><span class="p">,</span> <span class="k">array</span><span class="p">(</span><span class="s1">&#39;model_1&#39;</span><span class="p">,</span> <span class="s1">&#39;model_2&#39;</span><span class="p">,</span> <span class="s1">&#39;model_3&#39;</span><span class="p">,</span> <span class="s1">&#39;model_4&#39;</span><span class="p">,</span> <span class="s1">&#39;model_6&#39;</span><span class="p">),</span> <span class="mi">5</span><span class="p">),</span>
</span><span class='line'>        <span class="k">array</span><span class="p">(</span><span class="k">null</span><span class="p">,</span> <span class="s1">&#39;M&#39;</span><span class="p">,</span> <span class="k">null</span><span class="p">,</span> <span class="k">null</span><span class="p">,</span> <span class="k">null</span><span class="p">,</span> <span class="k">null</span><span class="p">,</span> <span class="k">array</span><span class="p">(</span><span class="s1">&#39;model_5&#39;</span><span class="p">),</span> <span class="mi">1</span><span class="p">),</span>
</span><span class='line'>        <span class="k">array</span><span class="p">(</span><span class="s1">&#39;black&#39;</span><span class="p">,</span> <span class="s1">&#39;XL&#39;</span><span class="p">,</span> <span class="k">null</span><span class="p">,</span> <span class="k">null</span><span class="p">,</span> <span class="k">null</span><span class="p">,</span> <span class="k">null</span><span class="p">,</span> <span class="k">array</span><span class="p">(</span><span class="s1">&#39;model_1&#39;</span><span class="p">),</span> <span class="mi">1</span><span class="p">),</span>
</span><span class='line'>        <span class="k">array</span><span class="p">(</span><span class="s1">&#39;black&#39;</span><span class="p">,</span> <span class="s1">&#39;M&#39;</span><span class="p">,</span> <span class="k">null</span><span class="p">,</span> <span class="k">null</span><span class="p">,</span> <span class="k">null</span><span class="p">,</span> <span class="k">null</span><span class="p">,</span> <span class="k">array</span><span class="p">(),</span> <span class="mi">0</span><span class="p">),</span>
</span><span class='line'>        <span class="k">array</span><span class="p">(</span><span class="s1">&#39;black&#39;</span><span class="p">,</span> <span class="s1">&#39;XL&#39;</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">23</span><span class="p">,</span> <span class="k">null</span><span class="p">,</span> <span class="k">array</span><span class="p">(),</span> <span class="mi">0</span><span class="p">),</span>
</span><span class='line'>        <span class="k">array</span><span class="p">(</span><span class="k">null</span><span class="p">,</span> <span class="k">null</span><span class="p">,</span> <span class="k">null</span><span class="p">,</span> <span class="k">null</span><span class="p">,</span> <span class="k">null</span><span class="p">,</span> <span class="k">true</span><span class="p">,</span> <span class="k">array</span><span class="p">(</span><span class="s1">&#39;model_1&#39;</span><span class="p">,</span> <span class="s1">&#39;model_3&#39;</span><span class="p">,</span> <span class="s1">&#39;model_4&#39;</span><span class="p">,</span> <span class="s1">&#39;model_5&#39;</span><span class="p">,</span> <span class="s1">&#39;model_6&#39;</span><span class="p">),</span> <span class="mi">5</span><span class="p">),</span>
</span><span class='line'>        <span class="k">array</span><span class="p">(</span><span class="k">null</span><span class="p">,</span> <span class="k">null</span><span class="p">,</span> <span class="k">null</span><span class="p">,</span> <span class="k">null</span><span class="p">,</span> <span class="k">null</span><span class="p">,</span> <span class="k">false</span><span class="p">,</span> <span class="k">array</span><span class="p">(</span><span class="s1">&#39;model_2&#39;</span><span class="p">),</span> <span class="mi">1</span><span class="p">),</span>
</span><span class='line'>        <span class="k">array</span><span class="p">(</span><span class="k">null</span><span class="p">,</span> <span class="k">null</span><span class="p">,</span> <span class="k">null</span><span class="p">,</span> <span class="mi">5</span><span class="p">,</span> <span class="k">null</span><span class="p">,</span> <span class="k">null</span><span class="p">,</span> <span class="k">array</span><span class="p">(</span><span class="s1">&#39;model_3&#39;</span><span class="p">),</span> <span class="mi">1</span><span class="p">),</span>
</span><span class='line'>        <span class="k">array</span><span class="p">(</span><span class="k">null</span><span class="p">,</span> <span class="k">null</span><span class="p">,</span> <span class="k">null</span><span class="p">,</span> <span class="mi">1000</span><span class="p">,</span> <span class="k">null</span><span class="p">,</span> <span class="k">null</span><span class="p">,</span> <span class="k">array</span><span class="p">(),</span> <span class="mi">0</span><span class="p">),</span>
</span><span class='line'>        <span class="k">array</span><span class="p">(</span><span class="k">null</span><span class="p">,</span> <span class="k">null</span><span class="p">,</span> <span class="k">null</span><span class="p">,</span> <span class="k">null</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="k">null</span><span class="p">,</span> <span class="k">array</span><span class="p">(</span><span class="s1">&#39;model_1&#39;</span><span class="p">,</span> <span class="s1">&#39;model_6&#39;</span><span class="p">),</span> <span class="mi">2</span><span class="p">),</span>
</span><span class='line'>        <span class="k">array</span><span class="p">(</span><span class="k">null</span><span class="p">,</span> <span class="k">null</span><span class="p">,</span> <span class="k">null</span><span class="p">,</span> <span class="k">null</span><span class="p">,</span> <span class="mi">100</span><span class="p">,</span> <span class="k">null</span><span class="p">,</span> <span class="k">array</span><span class="p">(),</span> <span class="mi">0</span><span class="p">)</span>
</span><span class='line'>    <span class="p">);</span>
</span><span class='line'><span class="p">}</span>
</span><span class='line'><span class="cp">?&gt;</span><span class="x"></span>
</span></code></pre></td></tr></table></div></figure>


<p>Когда это видишь первый раз на ревью, сначала прощаешь или не придаешь значение. Но команда &ndash; это лавина, особенно, если задание в релизе способствует появлению таких провайдеров. Иногда количество параметров достигало до 15. И в какой-то момент понимаешь, что надо брать ситуацию под контроль. Это осознание усиливается, когда в одном PR (Pull Request) несколько таких примеров. Что же делать?</p>

<p>Естественно, сначала оставляем комментарии, что-то вроде такого.</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
<span class='line-number'>15</span>
<span class='line-number'>16</span>
<span class='line-number'>17</span>
<span class='line-number'>18</span>
<span class='line-number'>19</span>
<span class='line-number'>20</span>
<span class='line-number'>21</span>
<span class='line-number'>22</span>
<span class='line-number'>23</span>
<span class='line-number'>24</span>
<span class='line-number'>25</span>
<span class='line-number'>26</span>
</pre></td><td class='code'><pre><code class='php'><span class='line'><span class="cp">&lt;?php</span>
</span><span class='line'><span class="sd">/**</span>
</span><span class='line'><span class="sd"> * @return array</span>
</span><span class='line'><span class="sd"> */</span>
</span><span class='line'><span class="k">public</span> <span class="k">function</span> <span class="nf">findBySearchMappingProvider</span><span class="p">()</span>
</span><span class='line'><span class="p">{</span>
</span><span class='line'>    <span class="k">return</span> <span class="k">array</span><span class="p">(</span>
</span><span class='line'>        <span class="c1">//$color, $size, $width, $length, $height, $enabled, $expectedReferences, $expectedResultCount</span>
</span><span class='line'>        <span class="c1">//find all models</span>
</span><span class='line'>        <span class="k">array</span><span class="p">(</span><span class="k">null</span><span class="p">,</span> <span class="k">null</span><span class="p">,</span> <span class="k">null</span><span class="p">,</span> <span class="k">null</span><span class="p">,</span> <span class="k">null</span><span class="p">,</span> <span class="k">null</span><span class="p">,</span> <span class="k">array</span><span class="p">(</span><span class="s1">&#39;model_1&#39;</span><span class="p">,</span> <span class="s1">&#39;model_2&#39;</span><span class="p">,</span> <span class="s1">&#39;model_3&#39;</span><span class="p">,</span> <span class="s1">&#39;model_4&#39;</span><span class="p">,</span> <span class="s1">&#39;model_5&#39;</span><span class="p">,</span> <span class="s1">&#39;model_6&#39;</span><span class="p">),</span> <span class="mi">6</span><span class="p">),</span>
</span><span class='line'>        <span class="c1">//find models by the color</span>
</span><span class='line'>        <span class="k">array</span><span class="p">(</span><span class="s1">&#39;black&#39;</span><span class="p">,</span> <span class="k">null</span><span class="p">,</span> <span class="k">null</span><span class="p">,</span> <span class="k">null</span><span class="p">,</span> <span class="k">null</span><span class="p">,</span> <span class="k">null</span><span class="p">,</span> <span class="k">array</span><span class="p">(</span><span class="s1">&#39;model_1&#39;</span><span class="p">),</span> <span class="mi">1</span><span class="p">),</span>
</span><span class='line'>        <span class="c1">//find models by the color</span>
</span><span class='line'>        <span class="k">array</span><span class="p">(</span><span class="s1">&#39;red&#39;</span><span class="p">,</span> <span class="k">null</span><span class="p">,</span> <span class="k">null</span><span class="p">,</span> <span class="k">null</span><span class="p">,</span> <span class="k">null</span><span class="p">,</span> <span class="k">null</span><span class="p">,</span> <span class="k">array</span><span class="p">(</span><span class="s1">&#39;model_2&#39;</span><span class="p">),</span> <span class="mi">1</span><span class="p">),</span>
</span><span class='line'>        <span class="c1">//trying find models by the non-existent color</span>
</span><span class='line'>        <span class="k">array</span><span class="p">(</span><span class="s1">&#39;NOTEXIST&#39;</span><span class="p">,</span> <span class="k">null</span><span class="p">,</span> <span class="k">null</span><span class="p">,</span> <span class="k">null</span><span class="p">,</span> <span class="k">null</span><span class="p">,</span> <span class="k">array</span><span class="p">(),</span> <span class="mi">0</span><span class="p">),</span>
</span><span class='line'>        <span class="c1">//find models by the size</span>
</span><span class='line'>        <span class="k">array</span><span class="p">(</span><span class="k">null</span><span class="p">,</span> <span class="s1">&#39;XL&#39;</span><span class="p">,</span> <span class="k">null</span><span class="p">,</span> <span class="k">null</span><span class="p">,</span> <span class="k">null</span><span class="p">,</span> <span class="k">array</span><span class="p">(</span><span class="s1">&#39;model_1&#39;</span><span class="p">,</span> <span class="s1">&#39;model_2&#39;</span><span class="p">,</span> <span class="s1">&#39;model_3&#39;</span><span class="p">,</span> <span class="s1">&#39;model_4&#39;</span><span class="p">,</span> <span class="s1">&#39;model_6&#39;</span><span class="p">),</span> <span class="mi">5</span><span class="p">),</span>
</span><span class='line'>        <span class="c1">//find models by the size</span>
</span><span class='line'>        <span class="k">array</span><span class="p">(</span><span class="k">null</span><span class="p">,</span> <span class="s1">&#39;M&#39;</span><span class="p">,</span> <span class="k">null</span><span class="p">,</span> <span class="k">null</span><span class="p">,</span> <span class="k">null</span><span class="p">,</span> <span class="k">array</span><span class="p">(</span><span class="s1">&#39;model_5&#39;</span><span class="p">),</span> <span class="mi">1</span><span class="p">),</span>
</span><span class='line'>
</span><span class='line'>        <span class="c1">// code</span>
</span><span class='line'>        <span class="c1">// code</span>
</span><span class='line'>    <span class="p">);</span>
</span><span class='line'><span class="p">}</span>
</span><span class='line'><span class="cp">?&gt;</span><span class="x"></span>
</span></code></pre></td></tr></table></div></figure>


<p>Так как это минимум умственных и временных затрат для достижения компромисса между программистом и владельцем продукта.</p>

<h3>Не комментируйте плохой код — перепишете его.</h3>

<p>Спустя время мы нашли несколько решений. До сих пор у меня нет объяснения, почему они сразу не всплыли. Вспомним цитату выше. Нам нужно всего лишь показать, что мы хотим протестировать. А многочисленные <code>null</code> лишь говорят о том, что эти значения нас не интересуют для этого теста.</p>

<p>Воспользуемся советом дядюшки Боба.</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
<span class='line-number'>15</span>
<span class='line-number'>16</span>
<span class='line-number'>17</span>
<span class='line-number'>18</span>
<span class='line-number'>19</span>
<span class='line-number'>20</span>
<span class='line-number'>21</span>
<span class='line-number'>22</span>
<span class='line-number'>23</span>
<span class='line-number'>24</span>
<span class='line-number'>25</span>
<span class='line-number'>26</span>
<span class='line-number'>27</span>
<span class='line-number'>28</span>
<span class='line-number'>29</span>
<span class='line-number'>30</span>
<span class='line-number'>31</span>
<span class='line-number'>32</span>
<span class='line-number'>33</span>
<span class='line-number'>34</span>
<span class='line-number'>35</span>
<span class='line-number'>36</span>
<span class='line-number'>37</span>
<span class='line-number'>38</span>
<span class='line-number'>39</span>
<span class='line-number'>40</span>
<span class='line-number'>41</span>
<span class='line-number'>42</span>
<span class='line-number'>43</span>
<span class='line-number'>44</span>
<span class='line-number'>45</span>
<span class='line-number'>46</span>
<span class='line-number'>47</span>
<span class='line-number'>48</span>
<span class='line-number'>49</span>
<span class='line-number'>50</span>
<span class='line-number'>51</span>
<span class='line-number'>52</span>
<span class='line-number'>53</span>
<span class='line-number'>54</span>
<span class='line-number'>55</span>
<span class='line-number'>56</span>
<span class='line-number'>57</span>
<span class='line-number'>58</span>
<span class='line-number'>59</span>
<span class='line-number'>60</span>
<span class='line-number'>61</span>
<span class='line-number'>62</span>
<span class='line-number'>63</span>
<span class='line-number'>64</span>
<span class='line-number'>65</span>
<span class='line-number'>66</span>
<span class='line-number'>67</span>
<span class='line-number'>68</span>
<span class='line-number'>69</span>
<span class='line-number'>70</span>
<span class='line-number'>71</span>
<span class='line-number'>72</span>
<span class='line-number'>73</span>
<span class='line-number'>74</span>
<span class='line-number'>75</span>
<span class='line-number'>76</span>
<span class='line-number'>77</span>
<span class='line-number'>78</span>
<span class='line-number'>79</span>
<span class='line-number'>80</span>
<span class='line-number'>81</span>
<span class='line-number'>82</span>
<span class='line-number'>83</span>
<span class='line-number'>84</span>
<span class='line-number'>85</span>
<span class='line-number'>86</span>
</pre></td><td class='code'><pre><code class='php'><span class='line'><span class="cp">&lt;?php</span>
</span><span class='line'><span class="sd">/**</span>
</span><span class='line'><span class="sd"> * @return array</span>
</span><span class='line'><span class="sd"> */</span>
</span><span class='line'><span class="k">public</span> <span class="k">function</span> <span class="nf">findBySearchMappingProvider</span><span class="p">()</span>
</span><span class='line'><span class="p">{</span>
</span><span class='line'>    <span class="k">return</span> <span class="k">array</span><span class="p">(</span>
</span><span class='line'>        <span class="c1">// find all models</span>
</span><span class='line'>        <span class="k">array</span><span class="p">(</span>
</span><span class='line'>            <span class="k">array</span><span class="p">(),</span>
</span><span class='line'>            <span class="k">array</span><span class="p">(</span><span class="s1">&#39;model_1&#39;</span><span class="p">,</span> <span class="s1">&#39;model_2&#39;</span><span class="p">,</span> <span class="s1">&#39;model_3&#39;</span><span class="p">,</span> <span class="s1">&#39;model_4&#39;</span><span class="p">,</span> <span class="s1">&#39;model_5&#39;</span><span class="p">,</span> <span class="s1">&#39;model_6&#39;</span><span class="p">),</span>
</span><span class='line'>             <span class="mi">6</span>
</span><span class='line'>         <span class="p">),</span>
</span><span class='line'>        <span class="k">array</span><span class="p">(</span>
</span><span class='line'>            <span class="k">array</span><span class="p">(</span><span class="s1">&#39;color&#39;</span> <span class="o">=&gt;</span> <span class="s1">&#39;black&#39;</span><span class="p">),</span>
</span><span class='line'>            <span class="k">array</span><span class="p">(</span><span class="s1">&#39;model_1&#39;</span><span class="p">),</span>
</span><span class='line'>            <span class="mi">1</span>
</span><span class='line'>        <span class="p">),</span>
</span><span class='line'>        <span class="k">array</span><span class="p">(</span>
</span><span class='line'>            <span class="k">array</span><span class="p">(</span><span class="s1">&#39;color&#39;</span> <span class="o">=&gt;</span> <span class="s1">&#39;red&#39;</span><span class="p">),</span>
</span><span class='line'>            <span class="k">array</span><span class="p">(</span><span class="s1">&#39;model_2&#39;</span><span class="p">),</span>
</span><span class='line'>            <span class="mi">1</span>
</span><span class='line'>        <span class="p">),</span>
</span><span class='line'>        <span class="k">array</span><span class="p">(</span>
</span><span class='line'>            <span class="k">array</span><span class="p">(</span><span class="s1">&#39;color&#39;</span> <span class="o">=&gt;</span> <span class="s1">&#39;NOTEXIST&#39;</span><span class="p">),</span>
</span><span class='line'>            <span class="k">array</span><span class="p">(),</span>
</span><span class='line'>            <span class="mi">0</span>
</span><span class='line'>        <span class="p">),</span>
</span><span class='line'>        <span class="k">array</span><span class="p">(</span>
</span><span class='line'>            <span class="k">array</span><span class="p">(</span><span class="s1">&#39;size&#39;</span> <span class="o">=&gt;</span> <span class="s1">&#39;XL&#39;</span><span class="p">),</span>
</span><span class='line'>            <span class="k">array</span><span class="p">(</span><span class="s1">&#39;model_1&#39;</span><span class="p">,</span> <span class="s1">&#39;model_2&#39;</span><span class="p">,</span> <span class="s1">&#39;model_3&#39;</span><span class="p">,</span> <span class="s1">&#39;model_4&#39;</span><span class="p">,</span> <span class="s1">&#39;model_6&#39;</span><span class="p">),</span>
</span><span class='line'>            <span class="mi">5</span>
</span><span class='line'>        <span class="p">),</span>
</span><span class='line'>        <span class="k">array</span><span class="p">(</span>
</span><span class='line'>            <span class="k">array</span><span class="p">(</span><span class="s1">&#39;size&#39;</span> <span class="o">=&gt;</span> <span class="s1">&#39;M&#39;</span><span class="p">),</span>
</span><span class='line'>            <span class="k">array</span><span class="p">(</span><span class="s1">&#39;model_5&#39;</span><span class="p">),</span>
</span><span class='line'>            <span class="mi">1</span>
</span><span class='line'>        <span class="p">),</span>
</span><span class='line'>        <span class="k">array</span><span class="p">(</span>
</span><span class='line'>            <span class="k">array</span><span class="p">(</span><span class="s1">&#39;color&#39;</span> <span class="o">=&gt;</span> <span class="s1">&#39;black&#39;</span><span class="p">,</span> <span class="s1">&#39;size&#39;</span> <span class="o">=&gt;</span> <span class="s1">&#39;XL&#39;</span><span class="p">),</span>
</span><span class='line'>            <span class="k">array</span><span class="p">(</span><span class="s1">&#39;model_1&#39;</span><span class="p">),</span>
</span><span class='line'>            <span class="mi">1</span>
</span><span class='line'>        <span class="p">),</span>
</span><span class='line'>        <span class="k">array</span><span class="p">(</span>
</span><span class='line'>            <span class="k">array</span><span class="p">(</span><span class="s1">&#39;color&#39;</span> <span class="o">=&gt;</span> <span class="s1">&#39;black&#39;</span><span class="p">,</span> <span class="s1">&#39;size&#39;</span> <span class="o">=&gt;</span> <span class="s1">&#39;M&#39;</span><span class="p">),</span>
</span><span class='line'>            <span class="k">array</span><span class="p">(),</span>
</span><span class='line'>            <span class="mi">0</span>
</span><span class='line'>        <span class="p">),</span>
</span><span class='line'>        <span class="k">array</span><span class="p">(</span>
</span><span class='line'>            <span class="k">array</span><span class="p">(</span><span class="s1">&#39;color&#39;</span> <span class="o">=&gt;</span> <span class="s1">&#39;black&#39;</span><span class="p">,</span> <span class="s1">&#39;size&#39;</span> <span class="o">=&gt;</span> <span class="s1">&#39;XL&#39;</span><span class="p">,</span> <span class="s1">&#39;width&#39;</span> <span class="o">=&gt;</span> <span class="mi">1</span><span class="p">,</span> <span class="s1">&#39;length&#39;</span> <span class="o">=&gt;</span><span class="p">,</span> <span class="s1">&#39;height&#39;</span> <span class="o">=&gt;</span> <span class="mi">23</span><span class="p">),</span>
</span><span class='line'>            <span class="k">array</span><span class="p">(),</span>
</span><span class='line'>            <span class="mi">0</span>
</span><span class='line'>        <span class="p">),</span>
</span><span class='line'>        <span class="k">array</span><span class="p">(</span>
</span><span class='line'>            <span class="k">array</span><span class="p">(</span><span class="s1">&#39;enabled&#39;</span> <span class="o">=&gt;</span> <span class="k">true</span><span class="p">),</span>
</span><span class='line'>            <span class="k">array</span><span class="p">(</span><span class="s1">&#39;model_1&#39;</span><span class="p">,</span> <span class="s1">&#39;model_3&#39;</span><span class="p">,</span> <span class="s1">&#39;model_4&#39;</span><span class="p">,</span> <span class="s1">&#39;model_5&#39;</span><span class="p">,</span> <span class="s1">&#39;model_6&#39;</span><span class="p">),</span>
</span><span class='line'>            <span class="mi">5</span>
</span><span class='line'>        <span class="p">),</span>
</span><span class='line'>        <span class="k">array</span><span class="p">(</span>
</span><span class='line'>            <span class="k">array</span><span class="p">(</span><span class="s1">&#39;enabled&#39;</span> <span class="o">=&gt;</span> <span class="k">false</span><span class="p">),</span>
</span><span class='line'>            <span class="k">array</span><span class="p">(</span><span class="s1">&#39;model_2&#39;</span><span class="p">),</span>
</span><span class='line'>            <span class="mi">1</span>
</span><span class='line'>        <span class="p">),</span>
</span><span class='line'>        <span class="k">array</span><span class="p">(</span>
</span><span class='line'>            <span class="k">array</span><span class="p">(</span><span class="s1">&#39;length&#39;</span> <span class="o">=&gt;</span> <span class="mi">5</span><span class="p">),</span>
</span><span class='line'>            <span class="k">array</span><span class="p">(</span><span class="s1">&#39;model_3&#39;</span><span class="p">),</span>
</span><span class='line'>            <span class="mi">1</span>
</span><span class='line'>        <span class="p">),</span>
</span><span class='line'>        <span class="k">array</span><span class="p">(</span>
</span><span class='line'>            <span class="k">array</span><span class="p">(</span><span class="s1">&#39;length&#39;</span> <span class="o">=&gt;</span> <span class="mi">1000</span><span class="p">),</span>
</span><span class='line'>            <span class="k">array</span><span class="p">(),</span>
</span><span class='line'>            <span class="mi">0</span>
</span><span class='line'>        <span class="p">),</span>
</span><span class='line'>        <span class="k">array</span><span class="p">(</span>
</span><span class='line'>            <span class="k">array</span><span class="p">(</span><span class="s1">&#39;height&#39;</span> <span class="o">=&gt;</span> <span class="mi">1</span><span class="p">),</span>
</span><span class='line'>            <span class="k">array</span><span class="p">(</span><span class="s1">&#39;model_1&#39;</span><span class="p">,</span> <span class="s1">&#39;model_6&#39;</span><span class="p">),</span>
</span><span class='line'>            <span class="mi">2</span>
</span><span class='line'>        <span class="p">),</span>
</span><span class='line'>        <span class="k">array</span><span class="p">(</span>
</span><span class='line'>            <span class="k">array</span><span class="p">(</span><span class="s1">&#39;height&#39;</span> <span class="o">=&gt;</span> <span class="mi">100</span><span class="p">),</span>
</span><span class='line'>            <span class="k">array</span><span class="p">(),</span>
</span><span class='line'>            <span class="mi">0</span>
</span><span class='line'>        <span class="p">)</span>
</span><span class='line'>    <span class="p">);</span>
</span><span class='line'><span class="p">}</span>
</span><span class='line'><span class="cp">?&gt;</span><span class="x"></span>
</span></code></pre></td></tr></table></div></figure>


<p>Вуаля, ассоциативные массивы спасают этот мир. Ключ массива выступает в роли комментария, и необходимость онного чаще всего излишне теперь (хотя НЕ всегда). Осталось теперь поправить сам код теста.</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
<span class='line-number'>15</span>
<span class='line-number'>16</span>
<span class='line-number'>17</span>
<span class='line-number'>18</span>
<span class='line-number'>19</span>
<span class='line-number'>20</span>
<span class='line-number'>21</span>
<span class='line-number'>22</span>
<span class='line-number'>23</span>
<span class='line-number'>24</span>
<span class='line-number'>25</span>
<span class='line-number'>26</span>
<span class='line-number'>27</span>
<span class='line-number'>28</span>
<span class='line-number'>29</span>
<span class='line-number'>30</span>
<span class='line-number'>31</span>
</pre></td><td class='code'><pre><code class='php'><span class='line'><span class="cp">&lt;?php</span>
</span><span class='line'><span class="sd">/**</span>
</span><span class='line'><span class="sd"> * @test</span>
</span><span class='line'><span class="sd"> * @dataProvider findBySearchMappingProvider</span>
</span><span class='line'><span class="sd"> *</span>
</span><span class='line'><span class="sd"> * @param array $dataMapping</span>
</span><span class='line'><span class="sd"> * @param array $expectedReferences</span>
</span><span class='line'><span class="sd"> * @param integer $expectedResultCount</span>
</span><span class='line'><span class="sd"> */</span>
</span><span class='line'><span class="k">public</span> <span class="k">function</span> <span class="nf">findBySearchMapping</span><span class="p">(</span><span class="nv">$mappingData</span><span class="p">,</span> <span class="nv">$expectedReferences</span><span class="p">,</span> <span class="nv">$expectedResultCount</span><span class="p">)</span>
</span><span class='line'><span class="p">{</span>
</span><span class='line'>    <span class="nv">$expectedResults</span> <span class="o">=</span> <span class="k">array</span><span class="p">();</span>
</span><span class='line'>    <span class="k">foreach</span> <span class="p">(</span><span class="nv">$expectedReferences</span> <span class="k">as</span> <span class="nv">$referenceName</span><span class="p">)</span> <span class="p">{</span>
</span><span class='line'>        <span class="nv">$expectedResults</span><span class="p">[]</span> <span class="o">=</span> <span class="nv">$this</span><span class="o">-&gt;</span><span class="na">referenceRepository</span><span class="o">-&gt;</span><span class="na">getReference</span><span class="p">(</span><span class="nv">$referenceName</span><span class="p">);</span>
</span><span class='line'>    <span class="p">}</span>
</span><span class='line'>
</span><span class='line'>    <span class="nv">$searchMapping</span> <span class="o">=</span> <span class="k">new</span> <span class="nx">SearchMapping</span><span class="p">();</span>
</span><span class='line'>    <span class="nv">$searchMapping</span><span class="o">-&gt;</span><span class="na">setColor</span><span class="p">(</span><span class="nb">isset</span><span class="p">(</span><span class="nv">$mappingData</span><span class="p">[</span><span class="s1">&#39;color&#39;</span><span class="p">])</span> <span class="o">?</span> <span class="nv">$mappingData</span><span class="p">[</span><span class="s1">&#39;color&#39;</span><span class="p">]</span> <span class="o">:</span> <span class="k">null</span><span class="p">)</span>
</span><span class='line'>        <span class="o">-&gt;</span><span class="na">setSize</span><span class="p">(</span><span class="nb">isset</span><span class="p">(</span><span class="nv">$mappingData</span><span class="p">[</span><span class="s1">&#39;size&#39;</span><span class="p">])</span> <span class="o">?</span> <span class="nv">$mappingData</span><span class="p">[</span><span class="s1">&#39;size&#39;</span><span class="p">]</span> <span class="o">:</span> <span class="k">null</span><span class="p">)</span>
</span><span class='line'>        <span class="o">-&gt;</span><span class="na">setWidth</span><span class="p">(</span><span class="nb">isset</span><span class="p">(</span><span class="nv">$mappingData</span><span class="p">[</span><span class="s1">&#39;width&#39;</span><span class="p">])</span> <span class="o">?</span> <span class="nv">$mappingData</span><span class="p">[</span><span class="s1">&#39;width&#39;</span><span class="p">]</span> <span class="o">:</span> <span class="k">null</span><span class="p">)</span>
</span><span class='line'>        <span class="o">-&gt;</span><span class="na">setLength</span><span class="p">(</span><span class="nb">isset</span><span class="p">(</span><span class="nv">$mappingData</span><span class="p">[</span><span class="s1">&#39;length&#39;</span><span class="p">])</span> <span class="o">?</span> <span class="nv">$mappingData</span><span class="p">[</span><span class="s1">&#39;length&#39;</span><span class="p">]</span> <span class="o">:</span> <span class="k">null</span><span class="p">)</span>
</span><span class='line'>        <span class="o">-&gt;</span><span class="na">setHeight</span><span class="p">(</span><span class="nb">isset</span><span class="p">(</span><span class="nv">$mappingData</span><span class="p">[</span><span class="s1">&#39;heigth&#39;</span><span class="p">])</span> <span class="o">?</span> <span class="nv">$mappingData</span><span class="p">[</span><span class="s1">&#39;height&#39;</span><span class="p">]</span> <span class="o">:</span> <span class="k">null</span><span class="p">)</span>
</span><span class='line'>        <span class="o">-&gt;</span><span class="na">setEnabled</span><span class="p">(</span><span class="nb">isset</span><span class="p">(</span><span class="nv">$mappingData</span><span class="p">[</span><span class="s1">&#39;enabled&#39;</span><span class="p">])</span> <span class="o">?</span> <span class="nv">$mappingData</span><span class="p">[</span><span class="s1">&#39;enabled&#39;</span><span class="p">]</span> <span class="o">:</span> <span class="k">null</span><span class="p">);</span>
</span><span class='line'>
</span><span class='line'>    <span class="nv">$results</span> <span class="o">=</span> <span class="nv">$this</span><span class="o">-&gt;</span><span class="na">uut</span><span class="o">-&gt;</span><span class="na">findBySearchMapping</span><span class="p">(</span><span class="nv">$searchMapping</span><span class="p">);</span>
</span><span class='line'>
</span><span class='line'>    <span class="nv">$this</span><span class="o">-&gt;</span><span class="na">assertCount</span><span class="p">(</span><span class="nv">$expectedResultCount</span><span class="p">,</span> <span class="nv">$results</span><span class="p">);</span>
</span><span class='line'>    <span class="nv">$this</span><span class="o">-&gt;</span><span class="na">assertContainsOnlyInstancesOf</span><span class="p">(</span><span class="s1">&#39;SomeInterface&#39;</span><span class="p">,</span> <span class="nv">$results</span><span class="p">);</span>
</span><span class='line'>    <span class="nv">$this</span><span class="o">-&gt;</span><span class="na">assertEquals</span><span class="p">(</span><span class="nv">$expectedResults</span><span class="p">,</span> <span class="nv">$results</span><span class="p">);</span>
</span><span class='line'><span class="p">}</span>
</span><span class='line'><span class="cp">?&gt;</span><span class="x"></span>
</span></code></pre></td></tr></table></div></figure>


<h3>Рефакторинг</h3>

<p>Но негоже оставлять в таком виде тест, вдруг кто-то решит взять на заметку этот совет.</p>

<p>Во-первых, блок, получающий ожидаемые объекты, един как минимум для этого тест кейса. Во-вторых, тоже самое можно сказать про создание конфигурируемого объекта. При этом чаще всего это мок объект, и он используется в других тестах. В-третьих, я ненавижу параметр $expectedCounts, тем более когда есть набор ожидаемых объектов.</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
<span class='line-number'>15</span>
<span class='line-number'>16</span>
<span class='line-number'>17</span>
<span class='line-number'>18</span>
<span class='line-number'>19</span>
<span class='line-number'>20</span>
<span class='line-number'>21</span>
<span class='line-number'>22</span>
<span class='line-number'>23</span>
<span class='line-number'>24</span>
<span class='line-number'>25</span>
<span class='line-number'>26</span>
<span class='line-number'>27</span>
<span class='line-number'>28</span>
<span class='line-number'>29</span>
<span class='line-number'>30</span>
<span class='line-number'>31</span>
<span class='line-number'>32</span>
<span class='line-number'>33</span>
<span class='line-number'>34</span>
<span class='line-number'>35</span>
<span class='line-number'>36</span>
<span class='line-number'>37</span>
<span class='line-number'>38</span>
<span class='line-number'>39</span>
<span class='line-number'>40</span>
<span class='line-number'>41</span>
<span class='line-number'>42</span>
<span class='line-number'>43</span>
<span class='line-number'>44</span>
<span class='line-number'>45</span>
<span class='line-number'>46</span>
<span class='line-number'>47</span>
<span class='line-number'>48</span>
<span class='line-number'>49</span>
<span class='line-number'>50</span>
<span class='line-number'>51</span>
<span class='line-number'>52</span>
<span class='line-number'>53</span>
<span class='line-number'>54</span>
<span class='line-number'>55</span>
<span class='line-number'>56</span>
<span class='line-number'>57</span>
<span class='line-number'>58</span>
<span class='line-number'>59</span>
<span class='line-number'>60</span>
<span class='line-number'>61</span>
<span class='line-number'>62</span>
<span class='line-number'>63</span>
<span class='line-number'>64</span>
<span class='line-number'>65</span>
<span class='line-number'>66</span>
<span class='line-number'>67</span>
<span class='line-number'>68</span>
<span class='line-number'>69</span>
<span class='line-number'>70</span>
<span class='line-number'>71</span>
<span class='line-number'>72</span>
<span class='line-number'>73</span>
<span class='line-number'>74</span>
<span class='line-number'>75</span>
<span class='line-number'>76</span>
<span class='line-number'>77</span>
<span class='line-number'>78</span>
<span class='line-number'>79</span>
<span class='line-number'>80</span>
<span class='line-number'>81</span>
</pre></td><td class='code'><pre><code class='php'><span class='line'><span class="cp">&lt;?php</span>
</span><span class='line'><span class="sd">/**</span>
</span><span class='line'><span class="sd"> * @test</span>
</span><span class='line'><span class="sd"> * @dataProvider findBySearchMappingProvider</span>
</span><span class='line'><span class="sd"> *</span>
</span><span class='line'><span class="sd"> * @param array $dataMapping</span>
</span><span class='line'><span class="sd"> * @param array $expectedReferences</span>
</span><span class='line'><span class="sd"> */</span>
</span><span class='line'><span class="k">public</span> <span class="k">function</span> <span class="nf">findBySearchMapping</span><span class="p">(</span><span class="k">array</span> <span class="nv">$mappingData</span><span class="p">,</span> <span class="k">array</span> <span class="nv">$expectedReferences</span><span class="p">)</span>
</span><span class='line'><span class="p">{</span>
</span><span class='line'>    <span class="nv">$expectedResults</span> <span class="o">=</span> <span class="nv">$this</span><span class="o">-&gt;</span><span class="na">getSomethingByReferences</span><span class="p">(</span><span class="nv">$expectedReferences</span><span class="p">);</span>
</span><span class='line'>    <span class="nv">$searchMapping</span> <span class="o">=</span> <span class="nv">$this</span><span class="o">-&gt;</span><span class="na">getSearchMapping</span><span class="p">(</span><span class="nv">$mappingData</span><span class="p">);</span>
</span><span class='line'>
</span><span class='line'>    <span class="nv">$results</span> <span class="o">=</span> <span class="nv">$this</span><span class="o">-&gt;</span><span class="na">uut</span><span class="o">-&gt;</span><span class="na">findBySearchMapping</span><span class="p">(</span><span class="nv">$searchMapping</span><span class="p">);</span>
</span><span class='line'>
</span><span class='line'>    <span class="nv">$this</span><span class="o">-&gt;</span><span class="na">assertCount</span><span class="p">(</span><span class="nb">count</span><span class="p">(</span><span class="nv">$expectedResults</span><span class="p">),</span> <span class="nv">$results</span><span class="p">);</span>
</span><span class='line'>    <span class="nv">$this</span><span class="o">-&gt;</span><span class="na">assertContainsOnlyInstancesOf</span><span class="p">(</span><span class="s1">&#39;SomeInterface&#39;</span><span class="p">,</span> <span class="nv">$results</span><span class="p">);</span>
</span><span class='line'>    <span class="nv">$this</span><span class="o">-&gt;</span><span class="na">assertEquals</span><span class="p">(</span><span class="nv">$expectedResults</span><span class="p">,</span> <span class="nv">$results</span><span class="p">);</span>
</span><span class='line'><span class="p">}</span>
</span><span class='line'>
</span><span class='line'><span class="sd">/**</span>
</span><span class='line'><span class="sd"> * @return array</span>
</span><span class='line'><span class="sd"> */</span>
</span><span class='line'><span class="k">public</span> <span class="k">function</span> <span class="nf">findBySearchMappingProvider</span><span class="p">()</span>
</span><span class='line'><span class="p">{</span>
</span><span class='line'>    <span class="k">return</span> <span class="k">array</span><span class="p">(</span>
</span><span class='line'>        <span class="c1">// find all models</span>
</span><span class='line'>        <span class="k">array</span><span class="p">(</span>
</span><span class='line'>            <span class="k">array</span><span class="p">(),</span>
</span><span class='line'>            <span class="k">array</span><span class="p">(</span><span class="s1">&#39;model_1&#39;</span><span class="p">,</span> <span class="s1">&#39;model_2&#39;</span><span class="p">,</span> <span class="s1">&#39;model_3&#39;</span><span class="p">,</span> <span class="s1">&#39;model_4&#39;</span><span class="p">,</span> <span class="s1">&#39;model_5&#39;</span><span class="p">,</span> <span class="s1">&#39;model_6&#39;</span><span class="p">)</span>
</span><span class='line'>         <span class="p">),</span>
</span><span class='line'>        <span class="k">array</span><span class="p">(</span>
</span><span class='line'>            <span class="k">array</span><span class="p">(</span><span class="s1">&#39;color&#39;</span> <span class="o">=&gt;</span> <span class="s1">&#39;black&#39;</span><span class="p">),</span>
</span><span class='line'>            <span class="k">array</span><span class="p">(</span><span class="s1">&#39;model_1&#39;</span><span class="p">)</span>
</span><span class='line'>        <span class="p">),</span>
</span><span class='line'>
</span><span class='line'>        <span class="c1">//code</span>
</span><span class='line'>
</span><span class='line'>        <span class="k">array</span><span class="p">(</span>
</span><span class='line'>            <span class="k">array</span><span class="p">(</span><span class="s1">&#39;color&#39;</span> <span class="o">=&gt;</span> <span class="s1">&#39;black&#39;</span><span class="p">,</span> <span class="s1">&#39;size&#39;</span> <span class="o">=&gt;</span> <span class="s1">&#39;XL&#39;</span><span class="p">,</span> <span class="s1">&#39;width&#39;</span> <span class="o">=&gt;</span> <span class="mi">1</span><span class="p">,</span> <span class="s1">&#39;length&#39;</span> <span class="o">=&gt;</span><span class="p">,</span> <span class="s1">&#39;height&#39;</span> <span class="o">=&gt;</span> <span class="mi">23</span><span class="p">),</span>
</span><span class='line'>            <span class="k">array</span><span class="p">()</span>
</span><span class='line'>        <span class="p">),</span>
</span><span class='line'>        <span class="k">array</span><span class="p">(</span>
</span><span class='line'>            <span class="k">array</span><span class="p">(</span><span class="s1">&#39;enabled&#39;</span> <span class="o">=&gt;</span> <span class="k">true</span><span class="p">),</span>
</span><span class='line'>            <span class="k">array</span><span class="p">(</span><span class="s1">&#39;model_1&#39;</span><span class="p">,</span> <span class="s1">&#39;model_3&#39;</span><span class="p">,</span> <span class="s1">&#39;model_4&#39;</span><span class="p">,</span> <span class="s1">&#39;model_5&#39;</span><span class="p">,</span> <span class="s1">&#39;model_6&#39;</span><span class="p">)</span>
</span><span class='line'>        <span class="p">),</span>
</span><span class='line'>
</span><span class='line'>        <span class="c1">//code</span>
</span><span class='line'>    <span class="p">);</span>
</span><span class='line'><span class="p">}</span>
</span><span class='line'>
</span><span class='line'><span class="sd">/**</span>
</span><span class='line'><span class="sd"> * @param array $references</span>
</span><span class='line'><span class="sd"> * @return SomeInterface[]</span>
</span><span class='line'><span class="sd"> */</span>
</span><span class='line'><span class="k">private</span> <span class="k">function</span> <span class="nf">getSomethingByReferences</span><span class="p">(</span><span class="k">array</span> <span class="nv">$references</span><span class="p">)</span>
</span><span class='line'><span class="p">{</span>
</span><span class='line'>
</span><span class='line'>    <span class="nv">$models</span> <span class="o">=</span> <span class="k">array</span><span class="p">();</span>
</span><span class='line'>    <span class="k">foreach</span> <span class="p">(</span><span class="nv">$references</span> <span class="k">as</span> <span class="nv">$referenceName</span><span class="p">)</span> <span class="p">{</span>
</span><span class='line'>        <span class="nv">$models</span><span class="p">[]</span> <span class="o">=</span> <span class="nv">$this</span><span class="o">-&gt;</span><span class="na">referenceRepository</span><span class="o">-&gt;</span><span class="na">getReference</span><span class="p">(</span><span class="nv">$referenceName</span><span class="p">);</span>
</span><span class='line'>    <span class="p">}</span>
</span><span class='line'>
</span><span class='line'>    <span class="k">return</span> <span class="nv">$models</span><span class="p">;</span>
</span><span class='line'><span class="p">}</span>
</span><span class='line'>
</span><span class='line'><span class="sd">/**</span>
</span><span class='line'><span class="sd"> * @param array $mappingData</span>
</span><span class='line'><span class="sd"> * @return SearchMapping</span>
</span><span class='line'><span class="sd"> */</span>
</span><span class='line'><span class="k">private</span> <span class="k">function</span> <span class="nf">getSearchMapping</span><span class="p">(</span><span class="k">array</span> <span class="nv">$mappingData</span><span class="p">)</span>
</span><span class='line'><span class="p">{</span>
</span><span class='line'>    <span class="nv">$searchMapping</span> <span class="o">=</span> <span class="k">new</span> <span class="nx">SearchMapping</span><span class="p">();</span>
</span><span class='line'>    <span class="nv">$searchMapping</span><span class="o">-&gt;</span><span class="na">setColor</span><span class="p">(</span><span class="nb">isset</span><span class="p">(</span><span class="nv">$mappingData</span><span class="p">[</span><span class="s1">&#39;color&#39;</span><span class="p">])</span> <span class="o">?</span> <span class="nv">$mappingData</span><span class="p">[</span><span class="s1">&#39;color&#39;</span><span class="p">]</span> <span class="o">:</span> <span class="k">null</span><span class="p">)</span>
</span><span class='line'>        <span class="o">-&gt;</span><span class="na">setSize</span><span class="p">(</span><span class="nb">isset</span><span class="p">(</span><span class="nv">$mappingData</span><span class="p">[</span><span class="s1">&#39;size&#39;</span><span class="p">])</span> <span class="o">?</span> <span class="nv">$mappingData</span><span class="p">[</span><span class="s1">&#39;size&#39;</span><span class="p">]</span> <span class="o">:</span> <span class="k">null</span><span class="p">)</span>
</span><span class='line'>        <span class="o">-&gt;</span><span class="na">setWidth</span><span class="p">(</span><span class="nb">isset</span><span class="p">(</span><span class="nv">$mappingData</span><span class="p">[</span><span class="s1">&#39;width&#39;</span><span class="p">])</span> <span class="o">?</span> <span class="nv">$mappingData</span><span class="p">[</span><span class="s1">&#39;width&#39;</span><span class="p">]</span> <span class="o">:</span> <span class="k">null</span><span class="p">)</span>
</span><span class='line'>        <span class="o">-&gt;</span><span class="na">setLength</span><span class="p">(</span><span class="nb">isset</span><span class="p">(</span><span class="nv">$mappingData</span><span class="p">[</span><span class="s1">&#39;length&#39;</span><span class="p">])</span> <span class="o">?</span> <span class="nv">$mappingData</span><span class="p">[</span><span class="s1">&#39;length&#39;</span><span class="p">]</span> <span class="o">:</span> <span class="k">null</span><span class="p">)</span>
</span><span class='line'>        <span class="o">-&gt;</span><span class="na">setHeight</span><span class="p">(</span><span class="nb">isset</span><span class="p">(</span><span class="nv">$mappingData</span><span class="p">[</span><span class="s1">&#39;heigth&#39;</span><span class="p">])</span> <span class="o">?</span> <span class="nv">$mappingData</span><span class="p">[</span><span class="s1">&#39;height&#39;</span><span class="p">]</span> <span class="o">:</span> <span class="k">null</span><span class="p">)</span>
</span><span class='line'>        <span class="o">-&gt;</span><span class="na">setEnabled</span><span class="p">(</span><span class="nb">isset</span><span class="p">(</span><span class="nv">$mappingData</span><span class="p">[</span><span class="s1">&#39;enabled&#39;</span><span class="p">])</span> <span class="o">?</span> <span class="nv">$mappingData</span><span class="p">[</span><span class="s1">&#39;enabled&#39;</span><span class="p">]</span> <span class="o">:</span> <span class="k">null</span><span class="p">);</span>
</span><span class='line'><span class="p">}</span>
</span><span class='line'><span class="cp">?&gt;</span><span class="x"></span>
</span></code></pre></td></tr></table></div></figure>


<h3>Заключение</h3>

<p>Последний мой PR содержал data provider для сложного поиска c около 70 вариантами. И знаете, он выглядит &ldquo;удобоваримо&rdquo;. Я придерживаюсь такого правила, если, прокручивая провайдер колесиком мышки, вы все прекрасно понимаете &ndash; значит проверка на качество пройдена.</p>
</div>


  <footer>
    <p class="meta">
      
  

<span class="byline author vcard">Posted by <span class="fn">fightmaster</span></span>

      








  


<time datetime="2013-10-05T01:00:00+04:00" pubdate data-updated="true">Oct 5<span>th</span>, 2013</time>
      

<span class="categories">
  
    <a class='category' href='/blog/categories/clean-code/'>clean code</a>, <a class='category' href='/blog/categories/code-review/'>code review</a>, <a class='category' href='/blog/categories/data-provider/'>data provider</a>, <a class='category' href='/blog/categories/php/'>php</a>, <a class='category' href='/blog/categories/unit-tests/'>unit tests</a>
  
</span>


    </p>
    
      <div class="sharing">
  
  <a href="//twitter.com/share" class="twitter-share-button" data-url="http://fightmaster.github.io/blog/2013/10/05/unit-tests-data-provider-without-a-headache.html" data-via="old_fightmaster" data-counturl="http://fightmaster.github.io/blog/2013/10/05/unit-tests-data-provider-without-a-headache.html" >Tweet</a>
  
  
  <div class="g-plusone" data-size="medium"></div>
  
  
    <div class="fb-like" data-send="true" data-width="450" data-show-faces="false"></div>
  
</div>

    
    <p class="meta">
      
        <a class="basic-alignment left" href="/blog/2013/09/28/ohio-river-greenway-5-k.html" title="Previous Post: Ohio River Greenway 5K">&laquo; Ohio River Greenway 5K</a>
      
      
        <a class="basic-alignment right" href="/blog/2013/10/17/the-whole-point-is-that-it-happens.html" title="Next Post: Все дело в том, что так бывает...">Все дело в том, что так бывает... &raquo;</a>
      
    </p>
  </footer>
</article>

  <section>
    <h1>Comments</h1>
    <div id="disqus_thread" aria-live="polite"><noscript>Please enable JavaScript to view the <a href="http://disqus.com/?ref_noscript">comments powered by Disqus.</a></noscript>
</div>
  </section>

</div>

<aside class="sidebar">
  
    <section>
  <h1>Recent Posts</h1>
  <ul id="recent_posts">
    
      <li class="post">
        <a href="/blog/2014/02/02/clean-code-boolean-attribute.html">Чистый код. Boolean Attribute</a>
      </li>
    
      <li class="post">
        <a href="/blog/2013/10/30/amazon-or-the-client-always-right.html">Amazon, или клиент всегда прав</a>
      </li>
    
      <li class="post">
        <a href="/blog/2013/10/17/the-whole-point-is-that-it-happens.html">Все дело в том, что так бывает...</a>
      </li>
    
      <li class="post">
        <a href="/blog/2013/10/05/unit-tests-data-provider-without-a-headache.html">Unit Tests. Data Provider без головной боли</a>
      </li>
    
      <li class="post">
        <a href="/blog/2013/09/28/ohio-river-greenway-5-k.html">Ohio River Greenway 5K</a>
      </li>
    
  </ul>
</section>

<section>
  <h1>GitHub Repos</h1>
  <ul id="gh_repos">
    <li class="loading">Status updating...</li>
  </ul>
  
  <a href="https://github.com/fightmaster">@fightmaster</a> on GitHub
  
  <script type="text/javascript">
    $(document).ready(function(){
        if (!window.jXHR){
            var jxhr = document.createElement('script');
            jxhr.type = 'text/javascript';
            jxhr.src = '/javascripts/libs/jXHR.js';
            var s = document.getElementsByTagName('script')[0];
            s.parentNode.insertBefore(jxhr, s);
        }

        github.showRepos({
            user: 'fightmaster',
            count: 5,
            skip_forks: true,
            target: '#gh_repos'
        });
    });
  </script>
  <script src="/javascripts/github.js" type="text/javascript"> </script>
</section>



<section class="googleplus">
  <h1>
    <a href="https://plus.google.com/100149299742617855998?rel=author">
      <img src="http://www.google.com/images/icons/ui/gprofile_button-32.png" width="32" height="32">
      Google+
    </a>
  </h1>
</section>



  
</aside>


    </div>
  </div>
  <footer role="contentinfo"><p>
  Copyright &copy; 2014 - fightmaster -
  <span class="credit">Powered by <a href="http://octopress.org">Octopress</a></span>
</p>

</footer>
  

<script type="text/javascript">
      var disqus_shortname = 'fightmaster';
      
        
        // var disqus_developer = 1;
        var disqus_identifier = 'http://fightmaster.github.io/blog/2013/10/05/unit-tests-data-provider-without-a-headache.html';
        var disqus_url = 'http://fightmaster.github.io/blog/2013/10/05/unit-tests-data-provider-without-a-headache.html';
        var disqus_script = 'embed.js';
      
    (function () {
      var dsq = document.createElement('script'); dsq.type = 'text/javascript'; dsq.async = true;
      dsq.src = '//' + disqus_shortname + '.disqus.com/' + disqus_script;
      (document.getElementsByTagName('head')[0] || document.getElementsByTagName('body')[0]).appendChild(dsq);
    }());
</script>



<div id="fb-root"></div>
<script>(function(d, s, id) {
  var js, fjs = d.getElementsByTagName(s)[0];
  if (d.getElementById(id)) {return;}
  js = d.createElement(s); js.id = id; js.async = true;
  js.src = "//connect.facebook.net/en_US/all.js#appId=212934732101925&xfbml=1";
  fjs.parentNode.insertBefore(js, fjs);
}(document, 'script', 'facebook-jssdk'));</script>



  <script type="text/javascript">
    (function() {
      var script = document.createElement('script'); script.type = 'text/javascript'; script.async = true;
      script.src = 'https://apis.google.com/js/plusone.js';
      var s = document.getElementsByTagName('script')[0]; s.parentNode.insertBefore(script, s);
    })();
  </script>



  <script type="text/javascript">
    (function(){
      var twitterWidgets = document.createElement('script');
      twitterWidgets.type = 'text/javascript';
      twitterWidgets.async = true;
      twitterWidgets.src = '//platform.twitter.com/widgets.js';
      document.getElementsByTagName('head')[0].appendChild(twitterWidgets);
    })();
  </script>





</body>
</html>
